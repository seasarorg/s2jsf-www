<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- don't edit start -->
<head>
<title>Seasar - DI Container with AOP - </title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<link href="seasar_b.css" type="text/css" rel="stylesheet" media="screen" />
<link href="seasar_p.css" type="text/css" rel="stylesheet" media="print" />
<script src="seasar_b.js" type="text/JavaScript" language="JavaScript"></script>
</head>
<body onload="preload('ja')">
<table width="100%" border="0" cellspacing="0" cellpadding="0" align="left"><tr>
<td align="left" valign="top" width="780"><table width="780" border="0" cellspacing="0" cellpadding="0" class="white">
<tr><td colspan="7"><img height="5" width="780" src="images/top01_b.gif" alt=""></td></tr>
<tr><td><img height="117" width="235" src="images/top02_b.gif" alt="Seasar"></td>
<td colspan="3"><img height="117" width="289" src="images/top03.gif" alt="DI Container with AOP"></td>
<td colspan="3"><img height="117" width="256" src="images/spacer.gif" alt=""></td>
</tr><tr><td rowspan="2"><img src="images/top04.gif" alt="" height="49" width="235"></td>
<td><a href="http://www.seasar.org/index.html"><img src="images/menu01_b_ja.gif" height="30" width="78" border="0" alt="" id="menu01" onmouseover="swap(1)" onmouseout="restore(1)"></a></td>
<td><a href="http://www.seasar.org/projects.html"><img src="images/menu02_b_ja.gif" height="30" width="101" border="0" alt="" id="menu02" onmouseover="swap(2)" onmouseout="restore(2)"></a></td>
<td><a href="http://www.seasar.org/products.html"><img src="images/menu03_b_ja.gif" height="30" width="110" border="0" alt="" id="menu03" onmouseover="swap(3)" onmouseout="restore(3)"></a></td>
<td><a href="http://www.seasar.org/resources.html"><img src="images/menu04_b_ja.gif" height="30" width="113" border="0" alt="" id="menu04" onmouseover="swap(4)" onmouseout="restore(4)"></a></td>
<td><img src="images/menu05_b_ja.gif" height="30" width="109" border="0" alt="" id="menu05" onmouseover="swap(5)" onmouseout="restore(5)"></td>
<td><img height="30" width="34" src="images/menu06.gif" alt=""></td></tr><tr>
<td colspan="6"><img height="19" width="545" src="images/spacer.gif" alt=""></td></tr></table>
<table  width="780" border="0" cellspacing="0" cellpadding="0" height="100%" class="white">
<tr align="left" valign="top"><td width="18"><img height="14" width="18" src="images/spacer.gif" alt=""></td><td width="744" class="main">
<!-- don't edit end -->
<!-- document start -->
<h2>サンプル解説</h2>
<p>
s2jsf-exmapleのプログラムを順に解説します。
実際に動作するサンプルを参考に、S2JSFの使い方を学習しましょう。
</p>
<ul>
<li><a href="#itemsSave">Teeda ExtensionのItemsSave機能の使い方</a></li>
<li><a href="#app.dicon">app.diconでのコンポーネント自動登録</a></li>
<li><a href="#hello">hello.html</a></li>
<li><a href="#add">add.html</a></li>
<li><a href="#forEachList">forEachList.html</a></li>
<li><a href="#forEachResult">forEachResult.html</a></li>
<li><a href="#forEach2List">forEach2List.html</a></li>
<li><a href="#forEach3List">forEach3List.html</a></li>
<li><a href="#converter">converter.html</a></li>
<li><a href="#validator">validator.html</a></li>
<li><a href="#checkbox">checkbox.html</a></li>
<li><a href="#selectOneMenu">selectOneMenu.html</a></li>
<li><a href="#selectManyCheckbox">selectManyCheckbox.html</a></li>
<li><a href="#selectManyListbox">selectManyListbox.html</a></li>
<li><a href="#selectOneRadio">selectOneRadio.html</a></li>
<li><a href="#inputTextarea">inputTextarea.html</a></li>
<li><a href="#inputSecret">inputSecret.html</a></li>
<li><a href="#pageTran1">pageTran1.html</a></li>
<li><a href="#employeeManagement">Employee Management</a></li>
<ul>
<li><a href="#employeeSearch">employeeSearch.html</a></li>
<li><a href="#employeeEdit">employeeEdit.html</a></li>
<li><a href="#employeeConfirm">employeeConfirm.html</a></li>
<li><a href="#employeeList">employeeList.html</a></li>
</ul>
</ul>
<h2><a name="itemsSave">Teeda ExtensionのItemsSave機能の使い方</a></h2>
S2JSF1.1に限定されますが、Teeda Extensionの<a href="http://www.seasar.org/wiki/index.php?Teeda%2FgettingStarted#dec73883">ItemsSave</a>同様の機能を使用する事が可能です。<br/>
今まで、ForEachで使用していたListを次画面に引き継ぐには対象Listのinstance属性をsessionにする必要がありましたが<br/>
Teeda ExtensionのItemsSave機能を使う事によりinstance属性をrequestにして使用する事が可能です。<br/>
<b>使用手順</b>
<p>app.diconにRenderer登録用の以下の記述を追記します</p>
<pre>
  &lt;component
    class="org.seasar.teeda.core.render.autoregister.TeedaRendererComponentAutoRegister"&gt;
    &lt;initMethod name="addReferenceClass"&gt;
      &lt;arg&gt;@org.seasar.teeda.extension.render.html.HtmlTextRenderer@class&lt;/arg&gt;
    &lt;/initMethod&gt;
    &lt;initMethod name="addClassPattern"&gt;
      &lt;arg&gt;"org.seasar.teeda.extension.render.html"&lt;/arg&gt;
      &lt;arg&gt;"THtmlItemsSaveHiddenRenderer"&lt;/arg&gt;
    &lt;/initMethod&gt;
  &lt;/component&gt;
</pre>

<p>jsf.diconにTaglib登録として以下の記述を追加します</p>
<pre>
  &lt;initMethod name="addTaglibUri"&gt;
    &lt;arg&gt;"te"&lt;/arg&gt;
    &lt;arg&gt;"http://www.seasar.org/teeda/extension"&lt;/arg&gt;
  &lt;/initMethod&gt;
</pre>

<p>これでItemsSave機能自体を使う準備は整いました。</p>
<p>画面で使用するhogeDtoListというDTOのListはdiconファイルに以下のように登録されていると仮定します</p>
<p><b>※instance属性がrequestになっています</b></p>
<pre>
  &lt;component name="hogeDtoList" class="java.util.ArrayList" instance="request"&gt;
    &lt;initMethod name="add" &gt;
      &lt;arg&gt;
        &lt;component class="examples.jsf.dto.HogeDto" instance="prototype"&gt;
          &lt;property name="input"&gt;"aaa"&lt;/property&gt;
        &lt;/component&gt;
      &lt;/arg&gt;
    &lt;/initMethod&gt;
    &lt;initMethod name="add"&gt;
      &lt;arg&gt;
        &lt;component class="examples.jsf.dto.HogeDto" instance="prototype"&gt;
          &lt;property name="input"&gt;"bbb"&lt;/property&gt;
        &lt;/component&gt;
      &lt;/arg&gt;
    &lt;/initMethod&gt;
  &lt;/component&gt;
</pre>

<p>使用する画面のActionにListのgetterを用意します。</p>
<pre>
    /**
     * @return hogeDtoList
     */
    public List getHogeDtoList() {
        return hogeDtoList;
    }
</pre>

<p>実際のHTMLでは以下のように指定します</p>
<pre>
&lt;span m:inject="te:inputHidden" m:value="#{hogeDtoList}"/&gt;
</pre>




<h2><a name="app.dicon">app.diconでのコンポーネント自動登録</a></h2>
app.diconでは、
<a href="http://s2container.seasar.org/ja/DIContainer.html#ComponentAutoRegister">コンポーネントの自動登録</a>機能・
<a href="http://s2container.seasar.org/ja/DIContainer.html#AspectAutoRegister">アスペクトの自動登録</a>機能を用いて、
Action・Dto・LogicクラスをS2Containerへ登録しています。Action・Logicへは同時にアスペクトも登録しています。

<h3><a name="AutoRegisterForAction">Action自動登録</a></h3>
<p>
app.diconでActionをS2Containerへ登録している箇所はこのようになっています。
<pre>
01:&lt;component
02:    class="org.seasar.framework.container.autoregister.FileSystemComponentAutoRegister"
03:&gt;
04:    &lt;property name="instanceDef"&gt;
05:        @org.seasar.framework.container.deployer.InstanceDefFactory@REQUEST
06:    &lt;/property&gt;
07:    &lt;initMethod name="addClassPattern"&gt;
08:        &lt;arg&gt;"examples.jsf.action.impl"&lt;/arg&gt;
09:        &lt;arg&gt;".*ActionImpl"&lt;/arg&gt;
10:    &lt;/initMethod&gt;
11:&lt;/component&gt;
12:
13:&lt;component
14:    class="org.seasar.framework.container.autoregister.AspectAutoRegister"
15:&gt;
16:    &lt;property name="interceptor"&gt;actionInterceptorChain&lt;/property&gt;
17:    &lt;initMethod name="addClassPattern"&gt;
18:        &lt;arg&gt;"examples.jsf.action.impl"&lt;/arg&gt;
19:        &lt;arg&gt;".*ActionImpl"&lt;/arg&gt;
20:    &lt;/initMethod&gt;
21:&lt;/component&gt;
</pre>
01～11行目で、名称が"ActionImpl"で終わるクラスをrequestスコープへ登録しています。
これは、Actionクラスは入力された内容をsetter経由で受け取ることになるためです。
component名は、クラス名の先頭1文字を小文字にし、末尾のImplを除いた値になります。
クラス名が"aaa.bbb.FooActionImpl"の場合は"fooAction"がコンポーネント名になります。
</p>
<p>
13～21行目で、同じく"ActionImpl"で名称が終わるクラスにactionInterceptorChainアスペクトを登録しています。
actionInterceptorChainはexamples/jsf/dicon/allaop.diconで設定されています。
<pre>
01:&lt;component
02:    name="actionThrowsInterceptor"
03:    class="examples.jsf.interceptor.ActionThrowsInterceptor"
04:/&gt;
05:
06:&lt;component
07:    name="actionInterceptorChain"
08:    class="org.seasar.framework.aop.interceptors.InterceptorChain"
09:&gt;
11:    &lt;initMethod name="add"&gt;&lt;arg&gt;aop.traceInterceptor&lt;/arg&gt;&lt;/initMethod&gt;
12:    &lt;initMethod name="add"&gt;&lt;arg&gt;actionThrowsInterceptor&lt;/arg&gt;&lt;/initMethod&gt;
13:&lt;/component&gt;
</pre>
org.seasar.framework.aop.interceptors.InterceptorChainは、複数のInterceptorをグルーピング化し、利用しやすくします。
ここではaop.traceInterceptorとactionThrowsInterceptorを1つにまとめています。
1つ目のaop.traceInterceptorはaop.diconで以下のように定義しています。
<pre>
&lt;component name=&quot;traceInterceptor&quot;
    class=&quot;org.seasar.framework.aop.interceptors.TraceInterceptor&quot;
/&gt;
</pre>
org.seasar.framework.aop.interceptors.TraceInterceptorは、S2AOPで用意されているInterceptorで、
呼び出しの前後にトレース処理を行うものです。
actionInterceptorChainの2つ目のactionThrowsInterceptorは、
examples/jsf/dicon/allaop.diconで以下のように定義されています。
<pre>
&lt;component name=&quot;actionThrowsInterceptor&quot; 
    class=&quot;examples.jsf.interceptor.ActionThrowsInterceptor&quot;
/&gt;
</pre>
<p>examples.jsf.interceptor.ActionThrowsInterceptorは独自のThrowsInterceptorで以下のようになっています。</p>
<pre>
public class ActionThrowsInterceptor extends ThrowsInterceptor {
    public String handleThrowable(AppRuntimeException ex, MethodInvocation invocation)throws Throwable{
        FacesContext context = FacesContext.getCurrentInstance();
        context.addMessage(null, MessageUtil.getErrorMessage(ex.getMessageId(), ex.getArgs()));
        return null;
    }
}
</pre>
AppRuntimeExceptionからID/引数を取り出してFacesMessageを構築し、FacesContextへセットします。
このようにエラー処理をInterceptorにまかせれば、Actionの実装はPOJOで作成することができます。
</p>

<h3><a name="AutoRegisterForDto">DTO自動登録</a></h3>
<p>
app.diconでDTOをS2Containerへ登録している箇所はこのようになっています。
<pre>
&lt;component
    class="org.seasar.framework.container.autoregister.FileSystemComponentAutoRegister"
&gt;
    &lt;property name="instanceDef"&gt;
        @org.seasar.framework.container.deployer.InstanceDefFactory@REQUEST
    &lt;/property&gt;
    &lt;initMethod name="addClassPattern"&gt;
        &lt;arg&gt;"examples.jsf.dto"&lt;/arg&gt;
        &lt;arg&gt;".*Dto"&lt;/arg&gt;
    &lt;/initMethod&gt;
&lt;/component&gt;
</pre>
名称が"Dto"で終わるクラスをrequestスコープへ登録しています。
</p>

<h3><a name="AutoRegisterForLogic">Logic自動登録</a></h3>
<p>
app.diconでLogicをS2Containerへ登録している箇所はこのようになっています。
<pre>
01:&lt;component
02:    class="org.seasar.framework.container.autoregister.FileSystemComponentAutoRegister"
03:&gt;
04:    &lt;initMethod name="addClassPattern"&gt;
05:        &lt;arg&gt;"examples.jsf.logic.impl"&lt;/arg&gt;
06:        &lt;arg&gt;".*LogicImpl"&lt;/arg&gt;
07:    &lt;/initMethod&gt;
08:&lt;/component&gt;
09:
10:&lt;component
11:    class="org.seasar.framework.container.autoregister.AspectAutoRegister"
12:&gt;
13:    &lt;property name="interceptor"&gt;logicInterceptorChain&lt;/property&gt;
14:    &lt;initMethod name="addClassPattern"&gt;
15:        &lt;arg&gt;"examples.jsf.logic.impl"&lt;/arg&gt;
16:        &lt;arg&gt;".*LogicImpl"&lt;/arg&gt;
17:    &lt;/initMethod&gt;
18:&lt;/component&gt;
</pre>
01～08行目で、名称が"LogicImpl"で終わるクラスを登録しています。
インスタンスモードは、明示的に指定していないためデフォルトのsingletonになります。
10～18行目で、同じく"LogicImpl"で名称が終わるクラスにlogicInterceptorChainアスペクトを登録しています。
logicInterceptorChainはexamples/jsf/dicon/allaop.diconで設定されています。
<pre>
&lt;component
    name="logicInterceptorChain"
    class="org.seasar.framework.aop.interceptors.InterceptorChain"
&gt;
    &lt;initMethod name="add"&gt;&lt;arg&gt;aop.traceThrowsInterceptor&lt;/arg&gt;&lt;/initMethod&gt;
    &lt;initMethod name="add"&gt;&lt;arg&gt;aop.traceInterceptor&lt;/arg&gt;&lt;/initMethod&gt;
    &lt;initMethod name="add"&gt;&lt;arg&gt;j2ee.requiredTx&lt;/arg&gt;&lt;/initMethod&gt;
&lt;/component&gt;
</pre>
1つ目と2つ目は、S2AOPで用意されているInterceptorでトレース処理を行うものです。
詳しくは<a href="http://s2container.seasar.org/ja/aop.html#AOPInterceptor">S2AOPで用意されているInterceptor</a>を参照してください。
3つめのj2ee.requiredTxはトランザクション制御用コンポーネントです。トランザクションが開始されていなければ自動的にトランザクションを開始します。 
既にトランザクションが開始されていれば、そのトランザクションを引き継ぎます。
詳しくは<a href="http://s2container.seasar.org/ja/tx.html">トランザクションの自動制御</a>を参照してください。
</p>

<h3>Dao自動登録</h3>
<p>
app.diconでDaoをS2Containerへ登録している箇所はこのようになっています。
<pre>
01:&lt;component 
02:    class="org.seasar.framework.container.autoregister.FileSystemComponentAutoRegister"
03:&gt;
04:    &lt;initMethod name="addClassPattern"&gt;
05:        &lt;arg&gt;"examples.jsf.dao"&lt;/arg&gt;
06:        &lt;arg&gt;".*Dao"&lt;/arg&gt;
07:    &lt;/initMethod&gt;
08:&lt;/component&gt;
09:
11:&lt;component
12:    class="org.seasar.framework.container.autoregister.AspectAutoRegister"
13:&gt;
14:    &lt;property name="interceptor"&gt;daoInterceptorChain&lt;/property&gt;
15:    &lt;initMethod name="addClassPattern"&gt;
16:        &lt;arg&gt;"examples.jsf.dao"&lt;/arg&gt;
17:        &lt;arg&gt;".*Dao"&lt;/arg&gt;
18:    &lt;/initMethod&gt;
19:&lt;/component&gt;
</pre>
01～08行目で、名称が"Dao"で終わるクラス(インタフェース)をrequestスコープへ登録しています。
10～18行目で、同じく"Dao"で名称が終わるクラス(インタフェース)にdaoInterceptorChainアスペクトを登録しています。
daoInterceptorChainはexamples/jsf/dicon/allaop.diconで設定されています。
<pre>
&lt;component
    name="daoInterceptorChain"
    class="org.seasar.framework.aop.interceptors.InterceptorChain"
&gt;
    &lt;initMethod name="add"&gt;&lt;arg&gt;aop.traceInterceptor&lt;/arg&gt;&lt;/initMethod&gt;
    &lt;initMethod name="add"&gt;&lt;arg&gt;dao.interceptor&lt;/arg&gt;&lt;/initMethod&gt;
&lt;/component&gt;
</pre>
aspectタグのうちdao.interceptorは、dao.diconで定義されています。
これはS2Daoを機能させるためのInterceptor(org.seasar.dao.interceptors.S2DaoInterceptor)であり、
org.seasar.dao.impl.DaoMetaDataFactoryImplはS2DaoInterceptorのコンストラクタの引数となるのでとともに定義されています。</p>
<pre>
&lt;components namespace=&quot;dao&quot;&gt;
    &lt;include path=&quot;j2ee.dicon&quot;/&gt;
    &lt;component 
        class=&quot;org.seasar.dao.impl.DaoMetaDataFactoryImpl&quot;/&gt;
    &lt;component name=&quot;interceptor&quot;
        class=&quot;org.seasar.dao.interceptors.S2DaoInterceptor&quot;/&gt;
&lt;/components&gt;
</pre>
<p>これらの定義によりEmployeeDtoDao・DepartmentDtoDaoはインタフェースに対して、
実装クラスを自動的に生成して、EmployeeLogicImplのプロパティに設定しています。





</p>

<h2><a name="hello">hello.html</a></h2>
<p>ブラウザで、http://localhost:8080/s2jsf-example/hello/hello.html?message=aaaにアクセスしてみましょう。

Hello aaaと表示されるはずです。このサンプルでは、次のことを学びます。</p>
<ul>
<li>S2JSF用の名前空間の宣言。</li>
<li>レイアウト機能。</li>
<li>taglibの利用方法。</li>
<li>inject属性によるタグの指定。</li>
<li>titleタグの使い方。</li>
<li>リンクでページ遷移する方法。</li>
<li>ページ遷移のときにパラメータを渡す方法。</li>
<li>navigation-ruleの記述方法。</li>
<li>ValueBindingを使って文字列を出力する方法。</li>
</ul>
<p>それでは、HTMLの中身を見てみましょう。 </p>
<pre>
01:&lt;html xmlns:m=&quot;http://www.seasar.org/maya&quot; m:extends=&quot;/WEB-INF/layout/layout.html&quot;&gt;
02:&lt;head&gt;
03:&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=Windows-31j&quot; /&gt;
04:&lt;title&gt;Hello&lt;/title&gt;
05:&lt;/head&gt;
06:&lt;body&gt;
07:    &lt;span m:inject=&quot;f:param&quot; m:name=&quot;layoutTitle&quot; m:value=&quot;Hello&quot;/&gt;
08:    &lt;span m:inject=&quot;s:insert&quot; m:name=&quot;body&quot;&gt;
09:        Hello &lt;span m:value=&quot;#{message}&quot;&gt;hoge&lt;/span&gt;
10:    &lt;/span&gt;
11:&lt;/body&gt;
12:&lt;/html&gt;</pre>
<p>1行目のxmlns:m=&quot;http://www.seasar.org/maya&quot;で名前空間を指定しています。この

URI(http://www.seasar.org/maya)は固定です。プレフィックスのmは任意の値を指定することが出来ますが、慣例的にmを

使うことになっています。</p>
<p>
次のextends属性で、継承するレイアウトを指定しています。
一貫したLook &amp; Feelを提供するために、ページのレイアウトが、ヘッダー・メニュー・ボディ・フッターから構成され、
個別のページはボディ部分だけが異なるというのは、よく見かけるパターンではないでしょうか。
このようなニーズにこたえるために、S2JSFでは、ベースになるページでレイアウトを定義し、
個別のページではベースとなるページを継承して特定の部分(例えばボディ)だけを上書きするということが可能になっています。
それではlayout.htmlを見てみましょう。
</p>
<pre>
01:&lt;html xmlns:m=&quot;http://www.seasar.org/maya&quot;&gt;
02:&lt;head&gt;
03:&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=Windows-31j&quot; /&gt;
04:&lt;link m:inject=&quot;s:link&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/css/global.css&quot;/&gt;
05:&lt;title m:value=&quot;#{layoutTitle}&quot;/&gt;
06:&lt;/head&gt;
07:&lt;body&gt;
08:&lt;table border=&quot;0&quot; cellspacing=&quot;5&quot;&gt;
09:&lt;tr&gt;
10:  &lt;td colspan=&quot;2&quot;&gt;&lt;span m:inject=&quot;s:insert&quot; m:src=&quot;/WEB-INF/layout/header.html&quot;/&gt;&lt;/td&gt;
11:&lt;/tr&gt;
12:&lt;tr&gt;
13:  &lt;td width=&quot;140&quot; valign=&quot;top&quot;&gt;
14:    &lt;span m:inject=&quot;s:insert&quot; m:src=&quot;/WEB-INF/layout/menu.html&quot;/&gt;
15:  &lt;/td&gt;
16:  &lt;td valign=&quot;top&quot; align=&quot;left&quot;&gt;
17:    &lt;span m:inject=&quot;s:insert&quot; m:name=&quot;body&quot;/&gt;
18:  &lt;/td&gt;
19:&lt;/tr&gt;
20:&lt;tr&gt;
21:  &lt;td colspan=&quot;2&quot;&gt;
22:    &lt;hr/&gt;
23:  &lt;/td&gt;
24:&lt;/tr&gt;
25:&lt;tr&gt;
26: &lt;td colspan=&quot;2&quot;&gt;
27:    &lt;span m:inject=&quot;s:insert&quot; m:src=&quot;/WEB-INF/layout/footer.html&quot;/&gt;
28:  &lt;/td&gt;
29:&lt;/tr&gt;
30:&lt;/table&gt;
31:&lt;/body&gt;
32:&lt;/html&gt;
</pre>
<p>4行目のlinkタグを見てください。inject属性でs:linkというタグ名を指定しています。このタグ名の記述の仕方は、JSP

の場合と一緒です。sというプレフィックスは、WEB-INF/classes(WEB-INF/src)のjsf.diconに記述されています。jsf.dicon

の該当部分は次のようになります。</p>
<pre>&lt;component class=&quot;org.seasar.jsf.runtime.JsfConfigImpl&quot;&gt;
    &lt;initMethod name=&quot;addTaglibUri&quot;&gt;
        &lt;arg&gt;&quot;h&quot;&lt;/arg&gt;
        &lt;arg&gt;&quot;http://java.sun.com/jsf/html&quot;&lt;/arg&gt;
    &lt;initMethod&gt;
    &lt;initMethod name=&quot;addTaglibUri&quot;&gt;
        &lt;arg&gt;&quot;f&quot;&lt;/arg&gt;
        &lt;arg&gt;&quot;http://java.sun.com/jsf/core&quot;&lt;/arg&gt;
    &lt;initMethod&gt;
    &lt;initMethod name=&quot;addTaglibUri&quot;&gt;
        &lt;arg&gt;&quot;s&quot;&lt;/arg&gt;
        &lt;arg&gt;&quot;http://www.seasar.org/jsf&quot;&lt;/arg&gt;
    &lt;/initMethod&gt;
&lt;/component&gt;
</pre>
<p>inject属性を指定することで、任意のHTMLのタグを任意のJSF用のJSPのタグに変換できます。既存のJSF用のtaglibがそ

のまま再利用できるのです。</p>
<p>5行目でtitleを指定しています。layoutTitleの実際の値は、このレイアウトを継承したページで指定します。</p>
<p>10行目のinsertタグのsrc属性でヘッダー用のページを挿入しています。ヘッダー用のページは次のようになっています。
</p>
<pre>
&lt;html xmlns:m=&quot;http://www.seasar.org/maya&quot;&gt;
&lt;body&gt;
    &lt;span m:inject=&quot;s:insert&quot;&gt;
        &lt;img m:inject=&quot;h:graphicImage&quot; m:url=&quot;/images/seasar.gif&quot;/&gt;
    &lt;/span&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
<p>挿入されるページでは、name属性のないinsertタグの中に挿入したい内容を記述します。insertタグの外側にプレビュ

ー用にタグを書くことも出来ます。その場合、実行時には、insertタグの外側は無視されます。次は、menu.htmlを見てみましょう。</p>
<pre>
&lt;html xmlns:m=&quot;http://www.seasar.org/maya&quot;&gt;
...
&lt;body&gt;
    &lt;span m:inject=&quot;s:insert&quot;&gt;
        &lt;form&gt;
            &lt;ul&gt;
                &lt;li&gt;
                    &lt;a m:action=&quot;hello&quot;&gt;Hello
                        &lt;span m:inject=&quot;f:param&quot; m:name=&quot;message&quot; m:value=&quot;World&quot;/&gt;
                    &lt;/a&gt;
                &lt;/li&gt;
                &lt;li&gt;
                    &lt;a m:action=&quot;add&quot;&gt;Add&lt;/a&gt;
                &lt;/li&gt;
                ...
            &lt;/ul&gt;
        &lt;/form&gt;
    &lt;/span&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
<p>anchorタグのaction属性でリンクをクリックしたときに、遷移するページ名を指定します。
action属性は、${変数名.メソッド名}という形式でJavaBeansのメソッドを呼び出すことも出来ますが、単に文字列を指定した場合は指定したページに遷移するという意味になります。
このhelloというページ名はWEB-INF/faces-config.xmlで設定されています。
それでは、該当個所を見ていましょう。</p>
<pre>
&lt;navigation-rule&gt;
    &lt;navigation-case&gt;
        &lt;from-outcome&gt;hello&lt;/from-outcome&gt;
        &lt;to-view-id&gt;/hello/hello.html&lt;/to-view-id&gt;
        &lt;redirect/&gt;
    &lt;/navigation-case&gt;
&lt;/navigation-rule&gt;
</pre>
<p>from-outcomeでページ名(遷移先名)を指定します。to-view-idで指定するのが、実際のパスです。redirectタグを書くとリダイレクト、書かないとフォワードされることになります。menu.htmlの説明に戻ります。</p>
<p>anchorタグの子タグでf:paramタグを指定することにより、遷移先のページへパラメータを渡すことが出来ます。layout.htmlの説明に戻ります。</p>
<p>17行目の&lt;span m:inject=&quot;s:insert&quot; m:name=&quot;body&quot;/&gt;でボディ部分を定義しています。こ

のようにname属性で名前を付けておくと、このレイアウトを継承したページで同じように&lt;span

m:inject=&quot;s:insert&quot; m:name=&quot;body&quot;&gt;...,&lt;/span&gt;を定義することで、親のページの内容

を上書きすることが出来ます。それでは、hello.htmlの説明に戻ります。</p>
<p>7行目の&lt;span m:inject=&quot;f:param&quot; m:name=&quot;layoutTitle&quot; m:value=&quot;Hello&quot;/&gt;

でlayout.htmlで定義したlayoutTitleの値を設定しています。親のページにパラメータを渡すには、このようにbodyタグの

子タグとしてf:paramタグを記述します。</p>
<p>8行目から10行目の&lt;span m:inject=&quot;s:insert&quot; m:name=&quot;body&quot;&gt;で、親ページで定義した

内容を上書きします。</p>
<p>9行目の&lt;span m:value=&quot;#{message}&quot;&gt;hoge&lt;/span&gt;でHTMLに文字列を出力します。#{...}の記述

は、ValueBindingと呼ばれ、動的に値を変える場合に使います。#{変数名}のように指定した場合は、リクエストの属性、

パラメータ、セッションの属性、S2Containerの順番で検索し、最初に見つかった値を設定します。#{変数名.プロパティ名

}のように指定した場合は、先程と同様に変数名を解決し、その変数のプロパティの値を設定します。この例では、リクエ

ストのmessageパラメータの内容が出力されることになります。ボディのhogeは実行時には無視されます。ブラウザで直接プ

レビューするときにレイアウトを確認しやすくするためのダミーデータになります。HTMLに出力される文字列を動的に変え

たい場合は、このようにspanタグのvalue属性で指定します。</p>

<h2><a name="add">add.html</a></h2>
<p>このサンプルでは、次のことを学びます。</p>
<ul>
<li>入力値をJavaBeansのプロパティと連動させる方法。</li>
<li>ボタンをクリックしたときにJavaBeansのメソッドを呼び出す方法。</li>
<li>Actionにsetterメソッドを定義してリクエスト、セッション、S2Containerのオブジェクトをプロパティに自動設定する方法。</li>
</ul>
<p>それでは、HTMLの中身を見てみましょう。 </p>
<pre>
01:&lt;html xmlns:m=&quot;http://www.seasar.org/maya&quot; m:extends=&quot;/WEB-INF/layout/layout.html&quot;&gt;
02:&lt;head&gt;
03:&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=Windows-31j&quot; /&gt;
04:&lt;title&gt;Add&lt;/title&gt;
05:&lt;/head&gt;
06:&lt;body&gt;
07:  &lt;span m:inject=&quot;f:param&quot; m:name=&quot;layoutTitle&quot; m:value=&quot;Add&quot;/&gt;
08:  &lt;span m:inject=&quot;s:insert&quot; m:name=&quot;body&quot;&gt;
09:    &lt;form&gt;
10:      &lt;span m:inject=&quot;h:messages&quot; m:globalOnly=&quot;false&quot; m:showDetail=&quot;true&quot;/&gt;
11:      &lt;input type=&quot;text&quot; m:value=&quot;#{addDto.arg1}&quot;/&gt; + 
12:      &lt;input type=&quot;text&quot; m:value=&quot;#{addDto.arg2}&quot;/&gt; = 
13:      &lt;span m:value=&quot;#{addDto.result}&quot;/&gt; 
14:      &lt;input type=&quot;submit&quot; value=&quot;calculate&quot; m:action=&quot;#{addAction.calculate}&quot;/&gt;
15:    &lt;/form&gt;
16:  &lt;/span&gt;
17:&lt;/body&gt;
18:&lt;/html&gt;
</pre>
<p>headタグの部分は、実行時には無視されます。ブラウザでのプレビュー用です。</p>
<p>10行目の
<pre>
&lt;span m:inject=&quot;h:messages&quot; m:globalOnly=&quot;false&quot; m:showDetail=&quot;true&quot;/&gt;
</pre>
で、エラーが起きたときのメッセージを出力する準備をしています。
globalOnly属性がtrueの場合、個別の入力項目には関係のない(globalな)エラーのメッセージだけが出力されます。
falseにするとglobalなメッセージも個別のメッセージも出力するようになります。
</p>
<p>
11行目の
<pre>
&lt;input type=&quot;text&quot; m:value=&quot;#{addDto.arg1}&quot;/&gt;
</pre>
で、入出力用のタグとJavaBeansのプロパティを連動させています。
入力した値は、バリデーションがOKならJavaBeansのプロパティに格納され、
NGの場合は入力された値がそのままページに表示されることになります。
このように入出力値の管理をきちんと行ってくれるところがJSFの偉いところです。
StrutsのようにActionFormでとりあえずStringで受け取るなんて事をする必要がないのです。
</p>
<p>
addDtoは、app.diconで解説したようにexamples.jsf.dto.AddDtoクラスです。
</p>
<p>14行目の
<pre>
&lt;input type=&quot;submit&quot; value=&quot;calculate&quot; m:action=&quot;#{addAction.calculate}&quot;/&gt;
</pre>
で、ボタンがクリックされたときにJavaBeansのメソッドを呼び出す設定をしています。
ボタンやリンクのaction属性で、#{変数名.メソッド名}のように記述することをMethodBindingと呼びます。
MethodBindingで呼び出されるメソッドは、引数がなく戻り値がStringでなければいけません。
</p>
<p>
addActionは、app.diconで解説したようにexamples.teeda.action.impl.AddActionImplクラスです。
それでは、AddActionインターフェース・AddActionImplクラスを見てみましょう。
インターフェースと実装を必ず分離しなければならないということはありませんが、
このように分離すると仕様が明確に伝わり易いと思います。
</p>
<pre>
package examples.jsf.action;

public interface AddAction {

    public String calculate();

}
</pre>
<pre>
package examples.jsf.action.impl;

import examples.jsf.action.AddAction;
import examples.jsf.dto.AddDto;
import examples.jsf.logic.AddLogic;

public class AddActionImpl implements AddAction {

    private AddDto addDto;

    private AddLogic addLogic;

    public void setAddDto(AddDto addDto) {
        this.addDto = addDto;
    }

    public void setAddLogic(AddLogic addLogic) {
        this.addLogic = addLogic;
    }

    public String calculate() {
        int result = addLogic.calculate(addDto);
        addDto.setResult(result);
        return null;
    }

}
</pre>
<p>入力された値を受け取るために、addDtoプロパティのsetterメソッドを定義しています。
S2JSFはMethodBindingで指定したメソッドを呼び出す直前にsetterメソッドの定義されているプロパティがないか調べ、
もしある場合はプロパティ名と同様の変数がリクエスト属性・リクエストパラメータ・セッション属性・S2Containerに存在するか調べ、
もし存在する場合には自動的にsetterメソッドを呼び出してプロパティ名と同様の変数を設定します。</p>
<p>
プロパティの型がインターフェースの場合はS2Containerによってそのインターフェースを実装したクラスが自動的に設定されます。
AddLogicインタフェースを実装したActionはexamples.jsf.logic.impl.AddLogicImplです。
このクラスはapp.diconの自動登録設定によってS2Containerへ登録されます。
</p>
<p>MethodBindingで呼び出したメソッド(calculate)の戻り値がnullの場合は、自分自身に遷移することになります。
この場合はadd.htmlへ遷移します。
</p>

<h2><a name="forEachList">forEachList.html</a></h2>
<p>このサンプルでは、次のことを学びます。</p>
<ul>
<li>forEachタグによる繰り返し。</li>
<li>anchorタグでプレビュー時にページ遷移させる方法。</li>
<li>buttonrタグでプレビュー時にページ遷移させる方法。</li>
</ul>
<p>それでは、HTMLの一部を見てみましょう。 </p>
<pre>01:&lt;form&gt;
02:    &lt;table border=&quot;1&quot;&gt;
03:        &lt;tr bgcolor=&quot;#7777FF&quot;&gt;
04:            &lt;th&gt;Key&lt;/th&gt;
05:            &lt;th&gt;Name&lt;/th&gt;
06:            &lt;th colspan=&quot;2&quot;&gt;to ResultPage&lt;/th&gt;
07:        &lt;/tr&gt;
08:        &lt;span m:inject=&quot;s:forEach&quot; m:items=&quot;#{forEachDtoList}&quot;
09:            m:var=&quot;e&quot; m:varIndex=&quot;i&quot;&gt;
10:        &lt;tr&gt;
11:            &lt;td&gt;&lt;span m:value=&quot;#{e.key}&quot;&gt;111&lt;/span&gt;&lt;/td&gt;
12:            &lt;td&gt;&lt;span m:value=&quot;#{e.name}&quot;&gt;aaa&lt;/span&gt;&lt;/td&gt;
13:            &lt;td&gt;&lt;a href=&quot;forEachResult.html&quot; m:action=&quot;forEachResult&quot;&gt;to ResultPage
14:                    &lt;span m:inject=&quot;f:param&quot; m:name=&quot;index&quot; m:value=&quot;#{i}&quot;/&gt;
15:                &lt;/a&gt;
16:            &lt;/td&gt;
17:            &lt;td&gt;
18:                &lt;input type=&quot;button&quot; m:action=&quot;forEachResult&quot; value=&quot;to ResultPage&quot;
19:                    onclick=&quot;location.href='forEachResult.html'&quot;&gt;
20:                    &lt;span m:inject=&quot;f:param&quot; m:name=&quot;index&quot; m:value=&quot;#{i}&quot;/&gt;
21:                &lt;/input&gt;
22:            &lt;/td&gt;
23:        &lt;/tr&gt;
24:        &lt;/span&gt;
25:    &lt;/table&gt;
26:&lt;/form&gt;
</pre>
<p>8行目のforEachタグで繰り返しを指定します。items属性で繰り返す対象を、var属性で繰り返す際に個々の要素にアクセスするときの名前を、varIndex属性で繰り返す際にインデックスにアクセスするときの名前を指定します。</p>
<p>11行目のようにvar属性でつけた名前.プロパティという形でアクセスすることが出来ます。</p>
<p>13行目のanchorタグでhref属性とaction属性を両方指定しています。このように両方指定した場合、hrefは実行時には無視されます。ブラウザで直接プレビューしたときに、ページを遷移させるために記述しているのです。子タグのparamタグでページ遷移のときのパラメータを指定することができます。</p>
<p>18行目のbuttonタグもaction属性とonclick属性を指定しています。onclick属性のlocation.href='forEachResult.html'の部分は実行時には無視されます。ブラウザで直接プレビューしたときに、ページを遷移させるために記述しているのです。子タグのparamタグでページ遷移のときのパラメータを指定することができます。</p>

<h2><a name="forEachResult">forEachResult.html</a></h2>
<p>このサンプルでは、次のことを学びます。</p>
<ul>
<li>ページの初期処理。</li>
<li>Actionにgetterメソッドを定義してプロパティをリクエストやセッションに自動設定する方法。</li>
</ul>
<p>それでは、HTMLを見てみましょう。 </p>
<pre>
01:&lt;html xmlns:m=&quot;http://www.seasar.org/maya&quot;
02:    m:action=&quot;#{forEachResultInitAction.initialize}&quot;
03:    m:extends=&quot;/WEB-INF/layout/layout.html&quot;&gt;
04:&lt;head&gt;
05:&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=Windows-31j&quot; /&gt;
06:&lt;title&gt;ForEach&lt;/title&gt;
07:&lt;/head&gt;
08:&lt;body&gt;
09:&lt;span m:inject=&quot;f:param&quot; m:name=&quot;layoutTitle&quot; m:value=&quot;ForEach&quot;/&gt;
10:&lt;span m:inject=&quot;s:insert&quot; m:name=&quot;body&quot;&gt;
11:     Key:&lt;span m:value=&quot;#{forEachDto.key}&quot;&gt;111&lt;/span&gt;
12:     Name:&lt;span m:value=&quot;#{forEachDto.name}&quot;&gt;aaa&lt;/span&gt;&lt;br /&gt;
13:     &lt;a href=&quot;forEachList.html&quot;&gt;previous&lt;/a&gt;
14:&lt;/span&gt;
15:&lt;/body&gt;
16:&lt;/html&gt;
</pre>
<p>2行目のhtmlタグのaction属性で、ページを初期処理するメソッドを指定しています。
それでは、Actionクラスを見てみましょう。</p>
<pre>
package examples.jsf.action.impl;

import java.util.List;

import examples.jsf.action.ForEachResultInitAction;
import examples.jsf.dto.ForEachDto;

public class ForEachResultInitActionImpl implements ForEachResultInitAction {

    private int index;

    private List forEachDtoList;

    private ForEachDto forEachDto;

    public void setIndex(int index) {
        this.index = index;
    }

    public void setForEachDtoList(List forEachDtoList) {
        this.forEachDtoList = forEachDtoList;
    }

    public ForEachDto getForEachDto() {
        return forEachDto;
    }

    public String initialize() {
        forEachDto = (ForEachDto) forEachDtoList.get(index);
        return null;
    }
}
</pre>
<p>前のページで、anchorタグやbuttonタグのパラメータでindexを渡していたことを思い出してください。
setIndex()メソッドを定義しておけば、S2JSFが自動的にパラメータの値を設定してくれます。
また、setForEachDtoList()メソッドを定義しておくことで、examples/jsf/dicon/foreach.diconに定義されているforEachDtoListを参照できます。
initMethodタグを使えば、任意のメソッドを呼び出せるので、自由自在にオブジェクトを組み立てることが出来ます。</p>
<pre>
&lt;component name=&quot;forEachDtoList&quot; class=&quot;java.util.ArrayList&quot; instance=&quot;session&quot;&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;examples.jsf.dto.ForEachDto&quot; instance=&quot;prototype&quot;&gt;
                &lt;property name=&quot;key&quot;&gt;&quot;111&quot;&lt;/property&gt;
                &lt;property name=&quot;name&quot;&gt;&quot;aaa&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;examples.jsf.dto.ForEachDto&quot; instance=&quot;prototype&quot;&gt;
                &lt;property name=&quot;key&quot;&gt;&quot;222&quot;&lt;/property&gt;
                &lt;property name=&quot;name&quot;&gt;&quot;bbb&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
&lt;/component&gt;
</pre>
<p>initialize()メソッドで指定されたインデックスに基づくオブジェクトをforEachDtoプロパティに設定しています。
forEachDtoプロパティにはgetterメソッドが定義されているので、
initialize()メソッドが実行された後にS2JSFによってforEachDtoプロパティの値が自動的にリクエスト属性(forEachDto)に設定されます。
<pre>
public static final String プロパティ名_EXPORT = &quot;session&quot;;
</pre>
のように定数を宣言することで、リクエストではなくセッションの属性に設定することも出来ます。
</p>

<h2><a name="forEach2List">forEach2List.html</a></h2>
<p>このサンプルでは、次のことを学びます。</p>
<ul>
<li>入力系のタグを含んだforEachタグによる繰り返し。</li>
</ul>
<p>それでは、HTMLの一部を見てみましょう。 </p>
<pre>
01:&lt;form&gt;
02:    &lt;table border=&quot;1&quot;&gt;
03:        &lt;tr bgcolor=&quot;#7777FF&quot;&gt;
04:            &lt;th&gt;delete&lt;/th&gt;
05:            &lt;th&gt;input&lt;/th&gt;
06:        &lt;/tr&gt;
07:        &lt;span m:inject=&quot;s:forEach&quot; m:items=&quot;#{forEach2DtoList}&quot; m:var=&quot;e&quot;&gt;
08:        &lt;tr&gt;
09:            &lt;td&gt;&lt;input type=&quot;checkbox&quot; m:value=&quot;#{e.delete}&quot;/&gt;&lt;/td&gt;
10:            &lt;td&gt;&lt;input type=&quot;text&quot; m:value=&quot;#{e.input}&quot;&lt;/td&gt;
11:        &lt;/tr&gt;
12:        &lt;/span&gt;
13:    &lt;/table&gt;
14:    &lt;input type=&quot;submit&quot; value=&quot;update&quot; m:action=&quot;#{forEach2ListAction.update}&quot;/&gt;
15:    &lt;input type=&quot;submit&quot; value=&quot;add row&quot; m:action=&quot;#{forEach2ListAction.addRow}&quot;/&gt;
16:&lt;/form&gt;
</pre>
<p>このページでは、add rowボタンをクリックすると新規の行が挿入され、deleteのチェックボックスをチェックしてupdateボタンをクリックすることで行を削除することができます。また、入力値を書き換えてupdateボタンをクリックすることでinputの内容を更新することも出来ます。</p>
<p>入力系のタグを含んでいるといっても、forEachタグの使い方に特に違いはありません。Actionクラスは次のようになります。</p>
<pre>
package examples.jsf.action.impl;

import java.util.Iterator;
import java.util.List;

import examples.jsf.action.ForEach2ListAction;
import examples.jsf.dto.ForEach2Dto;

public class ForEach2ListActionImpl implements ForEach2ListAction {

    private List forEach2DtoList;

    public void setForEach2DtoList(List forEach2DtoList) {
        this.forEach2DtoList = forEach2DtoList;
    }

    public String update() {
        for (Iterator i = forEach2DtoList.iterator(); i.hasNext(); ) {
            ForEach2Dto dto = (ForEach2Dto) i.next();
            if (dto.isDelete()) {
                i.remove();
            }
        }
        return null;
    }

    public String addRow() {
        forEach2DtoList.add(new ForEach2Dto());
        return null;
    }
}
</pre>
<h2><a name="forEach3List">forEach3List.html</a></h2>
<p>このサンプルでは、次のことを学びます。</p>
<ul>
<li>forEachタグのネスト方法。</li>
</ul>
<p>それでは、HTMLの一部を見てみましょう。 </p>
<pre>
01:&lt;form&gt;
02:    &lt;table border=&quot;1&quot;&gt;
03:        &lt;span m:inject=&quot;s:forEach&quot; m:items=&quot;#{forEach3DtoList}&quot; m:var=&quot;e&quot;&gt;
04:        &lt;tr&gt;
05:            &lt;span m:inject=&quot;s:forEach&quot; m:items=&quot;#{e}&quot; m:var=&quot;e2&quot;&gt;
06:                &lt;td&gt;&lt;input type=&quot;text&quot; m:value=&quot;#{e2.value}&quot;&lt;/td&gt;
07:            &lt;/span&gt;
08:        &lt;/tr&gt;
09:        &lt;/span&gt;
10:    &lt;/table&gt;
11:    &lt;input type=&quot;submit&quot; value=&quot;submit&quot;/&gt;
12:&lt;/form&gt;
</pre>
<p>5行目を見てみるとわかるように、forEachタグの中でforEachタグを使用して繰り返しを行っています。forEach3DtoListはexamples/jsf/dicon/foreach.diconを見るとListの中にListがありますので、初めのforEachタグでvar属性をeとしているので2つ目のforEachタグでitems属性を&quot;#{e}&quot;とすることでforEach3DtoListの中のListを使用して繰り返し処理を行います。</p>
<pre>
&lt;components&gt;
    &lt;component name=&quot;forEach3DtoList&quot; class=&quot;java.util.ArrayList&quot; instance=&quot;session&quot;&gt;
        &lt;initMethod name=&quot;add&quot; &gt;
            &lt;arg&gt;
                &lt;component class=&quot;java.util.ArrayList&quot; instance=&quot;prototype&quot;&gt;
                    &lt;initMethod name=&quot;add&quot;&gt;
                        &lt;arg&gt;
                            new examples.jsf.dto.ForEach3Dto(&quot;11&quot;)
                        &lt;/arg&gt;
                    &lt;/initMethod&gt;
                    &lt;initMethod name=&quot;add&quot;&gt;
                        &lt;arg&gt;
                            new examples.jsf.dto.ForEach3Dto(&quot;12&quot;)
                        &lt;/arg&gt;
                    &lt;/initMethod&gt;
                &lt;/component&gt;
            &lt;/arg&gt;
        &lt;/initMethod&gt;
        &lt;initMethod name=&quot;add&quot; &gt;
            &lt;arg&gt;
                &lt;component class=&quot;java.util.ArrayList&quot; instance=&quot;prototype&quot;&gt;
                    &lt;initMethod name=&quot;add&quot;&gt;
                        &lt;arg&gt;
                            new examples.jsf.dto.ForEach3Dto(&quot;21&quot;)
                        &lt;/arg&gt;
                    &lt;/initMethod&gt;
                    &lt;initMethod name=&quot;add&quot;&gt;
                        &lt;arg&gt;
                            new examples.jsf.dto.ForEach3Dto(&quot;22&quot;)
                        &lt;/arg&gt;
                    &lt;/initMethod&gt;
                &lt;/component&gt;
            &lt;/arg&gt;
        &lt;/initMethod&gt;
    &lt;/component&gt;
&lt;/components&gt;
</pre>

<h2><a name="converter">converter.html</a></h2>
<p>このサンプルでは、次のことを学びます。</p>
<ul>
<li>converter属性の使い方。</li>
<li>エラーメッセージにm:labelを使用する方法。</li>
</ul>
<p>それでは、HTMLの一部を見てみましょう。 </p>
<pre>
&lt;form&gt;
    &lt;span m:inject=&quot;h:messages&quot; m:globalOnly=&quot;false&quot; m:showDetail=&quot;true&quot;/&gt;
    &lt;input type=&quot;text&quot; m:value=&quot;#{converterDto.aaa}&quot; m:label=&quot;Hire Date&quot;
        m:converter=&quot;#{inputDateTimeConverter}&quot;/&gt;&lt;br /&gt;
    &lt;span m:value=&quot;#{converterDto.aaa}&quot;
        m:converter=&quot;#{outputDateTimeConverter}&quot;/&gt;&lt;br /&gt;
    &lt;input type=&quot;submit&quot; value=&quot;submit&quot;/&gt;
&lt;/form&gt;
</pre>
<p>ほとんどの入出力用のタグはconverter属性を持っていて、
Javaのオブジェクトの値を文字列に変換したり、入力された文字列を適切なオブジェクトの型に変換するためのコンバータを指定することができます。
この例におけるコンバータは、examples/jsf/dicon/allconverter.diconで次のように定義されています。
</p>
<pre>
&lt;component name=&quot;inputDateTimeConverter&quot; class=&quot;org.seasar.jsf.convert.S2DateTimeConverter&quot;&gt;
    &lt;property name=&quot;pattern&quot;&gt;&quot;yyyyMMdd&quot;&lt;/property&gt;
&lt;/component&gt;
&lt;component name=&quot;outputDateTimeConverter&quot; class=&quot;org.seasar.jsf.convert.S2DateTimeConverter&quot;&gt;
    &lt;property name=&quot;pattern&quot;&gt;&quot;yyyy/MM/dd&quot;&lt;/property&gt;
&lt;/component&gt;
</pre>
<p>このようにコンバータをHTMLで個別に定義するのではなくdiconファイルで一元管理することで、
コンバータの定義が分散することを防ぐことが出来ます。
</p>
<p>
また、label属性に定義した値をコンバート失敗時のメッセージに使用することが出来ます。
それにはConverterがlabel属性に対応している必要があります。
標準のConverterについては、それぞれ対応するConverterをS2JSFで用意しています。
独自のConverterを作る場合はS2JSFを参考にしてください。
</p>

<h2><a name="validator">validator.html</a></h2>
<p>このサンプルでは、次のことを学びます。</p>
<ul>
<li>validatorタグの使い方。</li>
<li>関連チェックを行うバリデーションの方法。</li>
<li>messageタグの使い方。</li>
<li>バリデーションのメッセージでm:labelを使用する方法。</li>
</ul>
<p>それでは、HTMLの一部を見てみましょう。 </p>
<pre>
01:&lt;form&gt;
02:    &lt;span m:inject=&quot;h:messages&quot; m:globalOnly=&quot;true&quot;/&gt;
03:    UserName(2 letters or more):
04:    &lt;input id=&quot;userName&quot; type=&quot;text&quot;
05:        m:label = &quot;User Name&quot;
06:        m:value=&quot;#{validatorDto.userName}&quot; m:required=&quot;true&quot;&gt;
07:        &lt;span m:inject=&quot;s:validator&quot; m:binding=&quot;#{userNameLengthValidator}&quot;/&gt;
08:    &lt;/input&gt;
09:    &lt;span m:inject=&quot;h:message&quot; m:for=&quot;userName&quot;/&gt;&lt;br /&gt;
10:    From:
11:    &lt;input id=&quot;from&quot; type=&quot;text&quot;
12:        m:label = &quot;From&quot;&gt;
13:    &lt;/input&gt; - 
14:    To:
15:    &lt;input id=&quot;to&quot; type=&quot;text&quot;
16:        m:label = &quot;To&quot;&gt;
17:        &lt;span m:inject=&quot;s:validator&quot;
18:            m:binding=&quot;#{greaterEqualValidator}&quot;
19:            m:targetId=&quot;from&quot;/&gt;
20:    &lt;/input&gt;
21:    &lt;span m:inject=&quot;h:message&quot; m:for=&quot;to&quot;/&gt;&lt;br /&gt;
22:    &lt;input type=&quot;submit&quot; value=&quot;submit&quot;/&gt;
23:&lt;/form&gt;
</pre>
<p>バリデーションをかけたい場合、4行目のようにバリデーションの対象となるタグ(id:userName)の子タグとしてvalidatorタグを記述します。関連チェックバリデーションをかけたい場合、15行目のようにバリデーションの対象となるタグ(id:to)の子タグとしてvalidatorタグを記述します。validatorタグでは、targetId属性で関連チェックする相手を指定します。実際のバリデータは、validatorタグのbinding属性で指定します。この例におけるバリデータは、examples/jsf/dicon/allvalidator.diconで次のように定義されています。</p>
<pre>
&lt;component name=&quot;userNameLengthValidator&quot; class=&quot;javax.faces.validator.LengthValidator&quot;&gt;
    &lt;property name=&quot;minimum&quot;&gt;2&lt;/property&gt;
&lt;/component&gt;
&lt;component name=&quot;greaterEqualValidator&quot; class=&quot;org.seasar.jsf.validator.S2GreaterEqualValidator&quot;
    instance=&quot;prototype&quot;
/&gt;
</pre>

<p>S2GreaterEqualValidatorは、targetIdで関連チェックする相手を指定するのですが、
diconファイルの定義は1つでhtmlでtargetIdを追加するようになっています。
同じような処理で複数指定する場合があるので、diconファイルのinstance属性はprototypeにします。
</p>
<p>このようにバリデータをHTMLで個別に定義するのではなくdiconファイルで一元管理することで、バリデータの定義が分散することを防ぐことが出来ます。
</p>
<p>バリデーションエラーになったときに表示させるメッセージはmessageタグで組み込みます。
for属性で対象となるタグのidを指定します。
messagesタグでglobalOnly属性をfalseにすることで、messagesタグに表示させることも出来ますが、
どのタグがバリデーションエラーになったのかわかりやすくするために、
個別のタグのバリデーションエラーはmessageタグを使って表示させたほうが良いでしょう。
</p>
<p>また、label属性に定義した値をバリデーションのメッセージに使用することが出来ます。
lbel属性を使用する場合は、UIComponentとValidatorがそれぞれlabel属性に対応している必要があります。
JSF標準のUIComponentとValidatorについては、それぞれ対応するUIComponentとValidatorをS2JSFで用意しています。
独自のUIComponent・Validatorを作る場合は、S2JSFを参考にして機能を追加してください。
</p>

<h2><a name="checkbox">checkbox.html</a></h2>
<p>このサンプルでは、次のことを学びます。</p>
<ul>
<li>checkboxの使い方。</li>
</ul>
<p>それでは、HTMLの一部を見てみましょう。 </p>
<pre>
&lt;form&gt;
    &lt;input type=&quot;checkbox&quot; m:value=&quot;#{checkboxDto.aaa}&quot;/&gt;hoge&lt;br /&gt;
    &lt;span m:value=&quot;#{checkboxDto.aaa}&quot;/&gt;&lt;br /&gt;
    &lt;input type=&quot;submit&quot; value=&quot;submit&quot;/&gt;
&lt;/form&gt;
</pre>
<p>特に難しいところはありませんね。うれしいのは、チェックボックスをオフにしたときも、それがサーバサイドにきちんと伝わることです。</p>

<h2><a name="selectOneMenu">selectOneMenu.html</a></h2>
<p>このサンプルでは、次のことを学びます。</p>
<ul>
<li>selectタグで直接optionで要素を定義する方法。</li>
<li>selectタグでSelectItemで要素を定義する方法。</li>
<li>selectタグでJavaBeansで要素を定義する方法。</li>
</ul>
<p>それでは、HTMLの一部を見てみましょう。 </p>
<pre>
01:&lt;form&gt;
02:    &lt;select m:value=&quot;#{selectOneMenuDto.aaa}&quot;&gt;
03:        &lt;option value=&quot;1&quot;&gt;One&lt;/option&gt;
04:        &lt;option value=&quot;2&quot;&gt;Two&lt;/option&gt;
05:        &lt;option value=&quot;3&quot;&gt;Three&lt;/option&gt;
06:    &lt;/select&gt;&lt;br /&gt;
07:    &lt;span m:value=&quot;#{selectOneMenuDto.aaa}&quot;/&gt;&lt;br /&gt;
08:
09:    &lt;select m:value=&quot;#{selectOneMenuDto.bbb}&quot;
10:        m:items=&quot;#{selectOneMenuBbbItems}&quot;&gt;
11:        &lt;option value=&quot;&quot;&gt;Please select&lt;/option&gt;
12:        &lt;option value=&quot;1&quot;&gt;One&lt;/option&gt;
13:        &lt;option value=&quot;2&quot;&gt;Two&lt;/option&gt;
14:    &lt;/select&gt;&lt;br /&gt;
15:    &lt;span m:value=&quot;#{selectOneMenuDto.bbb}&quot;/&gt;&lt;br /&gt;
16:
17:    &lt;select m:value=&quot;#{selectOneMenuDto.ccc}&quot;
18:        m:items=&quot;#{selectOneMenuCccItems}&quot;
19:        m:itemValue=&quot;deptno&quot;
20:        m:itemLabel=&quot;dname&quot;
21:        m:nullLabel=&quot;Please select&quot;&gt;
22:        &lt;option value=&quot;&quot;&gt;Please select&lt;/option&gt;
23:        &lt;option value=&quot;10&quot;&gt;ACOUNTING&lt;/option&gt;
24:    &lt;/select&gt;&lt;br /&gt;
25:    &lt;span m:value=&quot;#{selectOneMenuDto.ccc}&quot;/&gt;&lt;br /&gt;
26:
27:    &lt;input type=&quot;submit&quot; value=&quot;submit&quot;/&gt;
28:&lt;/form&gt;
</pre>
<p>2行目からはじまるselectタグは、子タグのoptionタグで直接要素を指定しています。</p>
<p>9行目からはじまるselectタグは、items属性で要素を指定しています。items属性を指定した場合、子タグのoptionタグは実行時には無視されます。あくまでもブラウザでのプレビュー用です。selectOneMenuBbbItemsは、examples/jsf/dicon/selectonemenu.diconで次のように定義されています。</p>
<pre>
&lt;component name=&quot;selectOneMenuBbbItems&quot; class=&quot;java.util.ArrayList&quot;&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;javax.faces.model.SelectItem&quot;&gt;
                &lt;property name=&quot;label&quot;&gt;&quot;Please select&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;javax.faces.model.SelectItem&quot;&gt;
                &lt;property name=&quot;value&quot;&gt;1&lt;/property&gt;
                &lt;property name=&quot;label&quot;&gt;&quot;One&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;javax.faces.model.SelectItem&quot;&gt;
                &lt;property name=&quot;value&quot;&gt;2&lt;/property&gt;
                &lt;property name=&quot;label&quot;&gt;&quot;Two&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;javax.faces.model.SelectItem&quot;&gt;
                &lt;property name=&quot;value&quot;&gt;3&lt;/property&gt;
                &lt;property name=&quot;label&quot;&gt;&quot;Three&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;javax.faces.model.SelectItem&quot;&gt;
                &lt;property name=&quot;value&quot;&gt;4&lt;/property&gt;
                &lt;property name=&quot;label&quot;&gt;&quot;Four&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
&lt;/component&gt;
</pre>
<p>この例では、SelectItemを使って要素を定義しています。</p>
<p>17行目からはじまるselectタグは、items属性で要素を指定しています。この例の場合、個々の要素はJavaBeansなので、さらにitemValue属性とitemLabel属性で、どのプロパティを値として使うのか、どのプロパティをラベルとして使うのかを指定します。nullLabel属性を使いnullを設定する場合のラベルを指定することもできます。selectOneMenuCccItemsは、examples/jsf/dicon/selectonemenu.diconで次のように定義されています。</p>
<pre>
&lt;component name=&quot;selectOneMenuCccItems&quot; class=&quot;java.util.ArrayList&quot;&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;examples.jsf.entity.Department&quot;&gt;
                &lt;property name=&quot;deptno&quot;&gt;10&lt;/property&gt;
                &lt;property name=&quot;dname&quot;&gt;&quot;ACOUNTING&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;examples.jsf.entity.Department&quot;&gt;
                &lt;property name=&quot;deptno&quot;&gt;20&lt;/property&gt;
                &lt;property name=&quot;dname&quot;&gt;&quot;RESEARCH&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;examples.jsf.entity.Department&quot;&gt;
                &lt;property name=&quot;deptno&quot;&gt;30&lt;/property&gt;
                &lt;property name=&quot;dname&quot;&gt;&quot;SALES&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;examples.jsf.entity.Department&quot;&gt;
                &lt;property name=&quot;deptno&quot;&gt;40&lt;/property&gt;
                &lt;property name=&quot;dname&quot;&gt;&quot;OPERATIONS&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
&lt;/component&gt;
</pre>

<h2><a name="selectManyCheckbox">selectManyCheckbox.html</a></h2>
<p>このサンプルでは、次のことを学びます。</p>
<ul>
<li>selectManyCheckboxで直接checkboxで要素を定義する方法。</li>
<li>selectManyCheckboxでSelectItemで要素を定義する方法。</li>
<li>selectManyCheckboxでJavaBeansで要素を定義する方法。</li>
</ul>
<p>それでは、HTMLの一部を見てみましょう。 </p>
<pre>
01:&lt;form&gt;
02:    &lt;span m:inject=&quot;s:selectManyCheckbox&quot;
03:        m:value=&quot;#{selectManyCheckboxDto.aaa}&quot;&gt;
04:        &lt;input type=&quot;checkbox&quot; m:inject=&quot;s:selectItem&quot;
05:            m:itemLabel=&quot;One&quot; value=&quot;1&quot;/&gt;One
06:        &lt;input type=&quot;checkbox&quot; m:inject=&quot;s:selectItem&quot;
07:            m:itemLabel=&quot;Two&quot; value=&quot;2&quot; checked=&quot;checked&quot;/&gt;Two
08:        &lt;input type=&quot;checkbox&quot; m:inject=&quot;s:selectItem&quot;
09:            m:itemLabel=&quot;Three&quot; value=&quot;3&quot;/&gt;Three
10:    &lt;/span&gt;&lt;br /&gt;
11:
12:    &lt;span m:inject=&quot;s:selectManyCheckbox&quot;
13:        m:value=&quot;#{selectManyCheckboxDto.bbb}&quot;
14:        m:items=&quot;#{selectManyCheckboxBbbItems}&quot;&gt;
15:        &lt;input type=&quot;checkbox&quot; value=&quot;1&quot;/&gt;One
16:        &lt;input type=&quot;checkbox&quot; value=&quot;2&quot;/&gt;Two
17:        &lt;input type=&quot;checkbox&quot; value=&quot;3&quot;/&gt;Three
18:    &lt;/span&gt;&lt;br /&gt;
19:
20:    &lt;span m:inject=&quot;s:selectManyCheckbox&quot;
21:        m:value=&quot;#{selectManyCheckboxDto.ccc}&quot;
22:        m:items=&quot;#{selectManyCheckboxCccItems}&quot;
23:        m:itemValue=&quot;deptno&quot;
24:        m:itemLabel=&quot;dname&quot;&gt;
25:        &lt;input type=&quot;checkbox&quot; value=&quot;10&quot;/&gt;ACCOUNTING
26:    &lt;/span&gt;&lt;br /&gt;
27:
28:    &lt;input type=&quot;submit&quot; value=&quot;submit&quot;/&gt;
29:&lt;/form&gt;
</pre>
<p>2行目からはじまるselectManyCheckboxタグは、子タグのcheckboxタグで直接要素を指定しています。チェックされた値は、配列としてvalue属性で指定したプロパティに設定されます。</p>
<p>12行目からはじまるselectManyCheckboxタグは、items属性で要素を指定しています。items属性を指定した場合、子タグのcheckboxタグは実行時には無視されます。あくまでもブラウザでのプレビュー用です。selectManyCheckboxBbbItemsは、examples/jsf/dicon/selectmanycheckbox.diconで次のように定義されています。</p>
<pre>&lt;component name=&quot;selectManyCheckboxBbbItems&quot; class=&quot;java.util.ArrayList&quot;&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;javax.faces.model.SelectItem&quot;&gt;
                &lt;property name=&quot;value&quot;&gt;1&lt;/property&gt;
                &lt;property name=&quot;label&quot;&gt;&quot;One&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;javax.faces.model.SelectItem&quot;&gt;
                &lt;property name=&quot;value&quot;&gt;2&lt;/property&gt;
                &lt;property name=&quot;label&quot;&gt;&quot;Two&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;javax.faces.model.SelectItem&quot;&gt;
                &lt;property name=&quot;value&quot;&gt;3&lt;/property&gt;
                &lt;property name=&quot;label&quot;&gt;&quot;Three&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;javax.faces.model.SelectItem&quot;&gt;
                &lt;property name=&quot;value&quot;&gt;4&lt;/property&gt;
                &lt;property name=&quot;label&quot;&gt;&quot;Four&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
&lt;/component&gt;
</pre>
<p>この例では、SelectItemを使って要素を定義しています。</p>
<p>20行目からはじまるselectManyCheckboxタグは、items属性で要素を指定しています。この例の場合、個々の要素はJavaBeansなので、さらにitemValue属性とitemLabel属性で、どのプロパティを値として使うのか、どのプロパティをラベルとして使うのかを指定します。selectManyCheckboxCccItemsは、examples/jsf/dicon/selectmanycheckbox.diconで次のように定義されています。</p>
<pre>
&lt;component name=&quot;selectManyCheckboxCccItems&quot; class=&quot;java.util.ArrayList&quot;&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;examples.jsf.entity.Department&quot;&gt;
                &lt;property name=&quot;deptno&quot;&gt;10&lt;/property&gt;
                &lt;property name=&quot;dname&quot;&gt;&quot;ACOUNTING&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;examples.jsf.entity.Department&quot;&gt;
                &lt;property name=&quot;deptno&quot;&gt;20&lt;/property&gt;
                &lt;property name=&quot;dname&quot;&gt;&quot;RESEARCH&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;examples.jsf.entity.Department&quot;&gt;
                &lt;property name=&quot;deptno&quot;&gt;30&lt;/property&gt;
                &lt;property name=&quot;dname&quot;&gt;&quot;SALES&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;examples.jsf.entity.Department&quot;&gt;
                &lt;property name=&quot;deptno&quot;&gt;40&lt;/property&gt;
                &lt;property name=&quot;dname&quot;&gt;&quot;OPERATIONS&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
&lt;/component&gt;
</pre>

<h2><a name="selectManyListbox">selectManyListbox.html</a></h2>
<p>このサンプルでは、次のことを学びます。</p>
<ul>
<li>selectManyListboxで直接checkboxで要素を定義する方法。</li>
<li>selectManyListboxでSelectItemで要素を定義する方法。</li>
<li>selectManyListboxでJavaBeansで要素を定義する方法。</li>
</ul>
<p>それでは、HTMLの一部を見てみましょう。 </p>
<pre>
01:&lt;form&gt;
02:    &lt;select m:value=&quot;#{selectManyListboxDto.aaa}&quot; multiple=&quot;multiple&quot;&gt;
03:        &lt;option value=&quot;1&quot;&gt;One&lt;/option&gt;
04:        &lt;option value=&quot;2&quot;&gt;Two&lt;/option&gt;
05:        &lt;option value=&quot;3&quot;&gt;Three&lt;/option&gt;
06:    &lt;/select&gt;&lt;br /&gt;
07:
08:    &lt;select m:value=&quot;#{selectManyListboxDto.bbb}&quot;
09:        m:items=&quot;#{selectManyListboxBbbItems}&quot;
10:        multiple=&quot;multiple&quot;&gt;
11:        &lt;option value=&quot;1&quot;&gt;One&lt;/option&gt;
12:        &lt;option value=&quot;2&quot;&gt;Two&lt;/option&gt;
13:    &lt;/select&gt;&lt;br /&gt;
14:
15:    &lt;select m:value=&quot;#{selectManyListboxDto.ccc}&quot;
16:        m:items=&quot;#{selectManyListboxCccItems}&quot;
17:        m:itemValue=&quot;deptno&quot;
18:        m:itemLabel=&quot;dname&quot;
19:        multiple=&quot;multiple&quot;&gt;
20:        &lt;option value=&quot;10&quot;&gt;ACOUNTING&lt;/option&gt;
21:    &lt;/select&gt;&lt;br /&gt;
22:
23:    &lt;input type=&quot;submit&quot; value=&quot;submit&quot;/&gt;
24:&lt;/form&gt;
</pre>
<p>2行目からはじまるselectタグは、子タグのoptionタグで直接要素を指定しています。選択された値は、配列としてvalue属性で指定したプロパティに設定されます。</p>
<p>8行目からはじまるselectタグは、items属性で要素を指定しています。items属性を指定した場合、子タグのoptionタグは実行時には無視されます。あくまでもブラウザでのプレビュー用です。selectManyListboxBbbItemsは、examples/jsf/dicon/selectmanylistbox.diconで次のように定義されています。</p>
<pre>
&lt;component name=&quot;selectManyListboxBbbItems&quot; class=&quot;java.util.ArrayList&quot;&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;javax.faces.model.SelectItem&quot;&gt;
                &lt;property name=&quot;value&quot;&gt;1&lt;/property&gt;
                &lt;property name=&quot;label&quot;&gt;&quot;One&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;javax.faces.model.SelectItem&quot;&gt;
                &lt;property name=&quot;value&quot;&gt;2&lt;/property&gt;
                &lt;property name=&quot;label&quot;&gt;&quot;Two&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;javax.faces.model.SelectItem&quot;&gt;
                &lt;property name=&quot;value&quot;&gt;3&lt;/property&gt;
                &lt;property name=&quot;label&quot;&gt;&quot;Three&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;javax.faces.model.SelectItem&quot;&gt;
                &lt;property name=&quot;value&quot;&gt;4&lt;/property&gt;
                &lt;property name=&quot;label&quot;&gt;&quot;Four&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
&lt;/component&gt;
</pre>
<p>この例では、SelectItemを使って要素を定義しています。</p>
<p>15行目からはじまるselectタグは、items属性で要素を指定しています。この例の場合、個々の要素はJavaBeansなので、さらにitemValue属性とitemLabel属性で、どのプロパティを値として使うのか、どのプロパティをラベルとして使うのかを指定します。selectManyListboxCccItemsは、examples/jsf/dicon/selectmanylistbox.diconで次のように定義されています。</p>
<pre>
&lt;component name=&quot;selectManyListboxCccItems&quot; class=&quot;java.util.ArrayList&quot;&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;examples.jsf.entity.Department&quot;&gt;
                &lt;property name=&quot;deptno&quot;&gt;10&lt;/property&gt;
                &lt;property name=&quot;dname&quot;&gt;&quot;ACOUNTING&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;examples.jsf.entity.Department&quot;&gt;
                &lt;property name=&quot;deptno&quot;&gt;20&lt;/property&gt;
                &lt;property name=&quot;dname&quot;&gt;&quot;RESEARCH&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;examples.jsf.entity.Department&quot;&gt;
                &lt;property name=&quot;deptno&quot;&gt;30&lt;/property&gt;
                &lt;property name=&quot;dname&quot;&gt;&quot;SALES&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;examples.jsf.entity.Department&quot;&gt;
                &lt;property name=&quot;deptno&quot;&gt;40&lt;/property&gt;
                &lt;property name=&quot;dname&quot;&gt;&quot;OPERATIONS&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
&lt;/component&gt;
</pre>
<h2><A name=selectOneRadio>selectOneRadio.html</a></h2>
<p>このサンプルでは、次のことを学びます。</p>
<ul>
<li>selectOneRadioで直接radioで要素を定義する方法。 </li>
<li>selectOneRadioで必須チェックを定義する方法。  </li>
<li>selectOneRadioでJavaBeansで要素を定義する方法。 </li>
</ul>
<p>それでは、HTMLの一部を見てみましょう。 </p>
<pre>01:&lt;form&gt;
02:    &lt;span m:inject=&quot;s:selectOneRadio2&quot; id=&quot;radio1&quot;
03:        m:value=&quot;#{selectOneRadioDto.aaa}&quot;&gt;
04:        &lt;input type=&quot;radio&quot;
05:            name=&quot;aaa&quot;/&gt;Non-selection
06:        &lt;input type=&quot;radio&quot;
07:            name=&quot;aaa&quot; value=&quot;1&quot;/&gt;One
08:        &lt;input type=&quot;radio&quot;
09:            name=&quot;aaa&quot; value=&quot;2&quot; checked=&quot;checked&quot;/&gt;Two
10:        &lt;input type=&quot;radio&quot;
11:            name=&quot;aaa&quot; value=&quot;3&quot;/&gt;Three
12:    &lt;/span&gt;&lt;br /&gt;
13:
14:    &lt;span m:inject=&quot;s:selectOneRadio2&quot; id=&quot;radio2&quot;
15:        m:value=&quot;#{selectOneRadioDto.bbb}&quot;
16:        m:required=&quot;true&quot;&gt;
17:        &lt;input type=&quot;radio&quot;
18:            name=&quot;bbb&quot; value=&quot;1&quot;/&gt;One
19:        &lt;input type=&quot;radio&quot;
20:            name=&quot;bbb&quot; value=&quot;2&quot;/&gt;Two
21:        &lt;input type=&quot;radio&quot;
22:            name=&quot;bbb&quot; value=&quot;3&quot;/&gt;Three
23:    &lt;/span&gt;&lt;br /&gt;
24:
25:    &lt;span m:inject=&quot;s:selectOneRadio2&quot;
26:        m:value=&quot;#{selectOneRadioDto.ccc}&quot;&gt;
27:        &lt;span m:inject=&quot;s:forEach&quot;
28:            m:items=&quot;#{selectOneRadioCccItems}&quot;
29:            m:var=&quot;e&quot;&gt;
30:            &lt;input type=&quot;radio&quot;
31:                name=&quot;ccc&quot; value=&quot;#{e.deptno}&quot;/&gt;
32:            &lt;span m:value=&quot;#{e.dname}&quot;&gt;ACOUNTING&lt;/span&gt;
33:        &lt;/span&gt;
34:        &lt;span m:rendered=&quot;false&quot;&gt;
35:            &lt;input type=&quot;radio&quot;
36:                name=&quot;ccc&quot; value=&quot;20&quot;/&gt;RESEARCH
37:        &lt;/span&gt;
38:    &lt;/span&gt;&lt;br /&gt;
39:
40:    &lt;input type=&quot;submit&quot; value=&quot;submit&quot;/&gt;
41:&lt;/form&gt;
</pre>
<P>2行目からはじまるselectOneRadio2タグは、子タグのradioタグで直接要素を指定しています。選択された値は、value属性で指定したプロパティに設定されます。4行目からはじまるradioタグのようにvalue属性を記述しない場合は、nullが設定されます。</P>
<P>14行目からはじまるselectOneRadio2タグは、required属性で&quot;true&quot;を指定しています。required属性で&quot;true&quot;を指定した場合、実行時に必須チェックが行われます。選択されていない場合、次のようなバリデーションエラーメッセージが表示されます。</P>
<pre><ul><li>バリデーションエラー &quot;radio2&quot;: 値を入力して下さい.</ul></li></pre>
<P>この例では、forEachを使って要素を定義しています。</P>            
<P>25行目からはじまるselectOneRadio2タグは、子タグのforEachタグのitems属性で要素を指定しています。この例の場合、個々の要素はJavaBeansなので、さらにradioタグのvalue属性と32行目からはじまるタグのvalue属性で、どのプロパティを値として使うのか、どのプロパティをラベルとして使うのかを指定します。</p>
<p>34行目からはじまるタグは、rendered属性で&quot;false&quot;を指定しています。rendered属性で&quot;false&quot;を指定した場合、子タグのradioタグは実行時には無視されます。selectOneRadioCccItemsは、examples/jsf/dicon/selectoneradio.diconで次のように定義されています。</P>
<pre>&lt;component name=&quot;selectOneRadioCccItems&quot; class=&quot;java.util.ArrayList&quot;&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;examples.jsf.entity.Department&quot;&gt;
                &lt;property name=&quot;deptno&quot;&gt;10&lt;/property&gt;
                &lt;property name=&quot;dname&quot;&gt;&quot;ACOUNTING&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;examples.jsf.entity.Department&quot;&gt;
                &lt;property name=&quot;deptno&quot;&gt;20&lt;/property&gt;
                &lt;property name=&quot;dname&quot;&gt;&quot;RESEARCH&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;examples.jsf.entity.Department&quot;&gt;
                &lt;property name=&quot;deptno&quot;&gt;30&lt;/property&gt;
                &lt;property name=&quot;dname&quot;&gt;&quot;SALES&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
    &lt;initMethod name=&quot;add&quot; &gt;
        &lt;arg&gt;
            &lt;component class=&quot;examples.jsf.entity.Department&quot;&gt;
                &lt;property name=&quot;deptno&quot;&gt;40&lt;/property&gt;
                &lt;property name=&quot;dname&quot;&gt;&quot;OPERATIONS&quot;&lt;/property&gt;
            &lt;/component&gt;
        &lt;/arg&gt;
    &lt;/initMethod&gt;
&lt;/component&gt;
</pre>

<h2><a name=inputTextarea>inputTextarea.html</a></h2>
<p>このサンプルでは、次のことを学びます。</p>
<ul>
<li>textareaの入力値をJavaBeansのプロパティと連動させる方法。</li>
</ul>

<p>それでは、HTMLの一部を見てみましょう。 </p>
<pre>01:&lt;form&gt;
02:    &lt;span m:inject=&quot;h:messages&quot; m:globalOnly=&quot;false&quot; m:showDetail=&quot;true&quot;/&gt;
03:    &lt;textarea m:rows=&quot;5&quot; m:cols=&quot;50&quot; 
04:        wrap=&quot;soft&quot; m:value=&quot;#{inputTextareaDto.aaa}&quot;&gt;for test&lt;/textarea&gt;
05:    &lt;input type=&quot;submit&quot; value=&quot;submit&quot;/&gt;
06:&lt;/form&gt;
</pre>

<p>
3行目からはじまるtextareaタグのvalue属性で、JavaBeansのプロパティを連動させています。
入力した値は、バリデーションがOKならJavaBeansのプロパティに格納され、
NGの場合は入力された値がそのままページに表示されることになります。
textareaタグの要素は、あくまでもブラウザでのプレビュー用です。<
/p>
<h2><a name="inputSecret">inputSecret.html</a></h2>
<p>
<p>このサンプルでは、次のことを学びます。</p>
<ul>
<li>バリデーションのメッセージでm:labelを使用する方法。</li>
</ul>
</p>
<p>それでは、HTMLの中身から見てみましょう。 </p>
<pre>
&lt;span m:inject=&quot;h:messages&quot; m:globalOnly=&quot;false&quot; m:showDetail=&quot;true&quot;/&gt;
&lt;input type=&quot;password&quot; m:required=&quot;true&quot; m:label=&quot;password&quot;/&gt; 
&lt;input type=&quot;submit&quot; value=&quot;submit&quot;/&gt;
</pre>
<p>m:required=&quot;true&quot;としてあるので、何も入力せずにボタンをクリックすると以下のようにエラーメッセージにlabal属性のpasswordが使用されているのが分かります。</p>
<pre>
バリデーションエラー &quot;password&quot;: を値を入力して下さい
</pre>
<h2><a name="pageTran1">pageTran1.html</a></h2>
<p>このサンプルでは、次のことを学びます。</p>
<ul>
<li>エラーページの設定方法。</li>
</ul>
<p>それでは、HTMLの中身から見てみましょう。 </p>
<pre>
01:&lt;form&gt;
02:    &lt;input type=&quot;button&quot; value=&quot;The exception due to action&quot;
03         m:action=&quot;#{page1Action.throwException}&quot;/&gt;
03:    &lt;input type=&quot;button&quot; value=&quot;The exception due to initialize action&quot; m:action=&quot;pageTran2&quot; 
04:                    onclick=&quot;location.href='pageTran2.html'&quot; m:immediate=&quot;true&quot;/&gt;
05:&lt;/form&gt;
</pre>
<p>1つ目のボタンタグのaction属性のActionクラスを見てみましょう。</p>
<pre>
public class Page1ActionImpl implements Page1Action {
    public String throwException() {
        throw new ErrorPage1RuntimeException(&quot;errorPage1&quot;);
    }
}
</pre>
<p>examples.jsf.action.impl.Page1ActionImplクラスのthrowExceptionはErrorPage1RuntimeExceptionを発生させているだけです。
ErrorPage1RuntimeExceptionはjava.lang.RuntimeExceptionのサブクラスでメッセージに"errorPage1"をセットしています。
ErrorPage1RuntimeExceptionのエラーが発生した場合の画面の遷移先はjsfErrorPage.diconで以下のように設定しています。
</p>
<pre>
&lt;component class=&quot;org.seasar.jsf.runtime.ErrorPageManagerImpl&quot;&gt;
    <strong>&lt;initMethod name=&quot;addErrorPage&quot;&gt;
        &lt;arg&gt;@examples.jsf.exception.ErrorPage1RuntimeException@class&lt;/arg&gt;
        &lt;arg&gt;&quot;/errorpage/errorPage1.html&quot;&lt;/arg&gt;
    &lt;/initMethod&gt;</strong>
    &lt;initMethod name=&quot;addErrorPage&quot;&gt;
        &lt;arg&gt;@examples.jsf.exception.ErrorPage2RuntimeException@class&lt;/arg&gt;
        &lt;arg&gt;&quot;/errorpage/errorPage2.html&quot;&lt;/arg&gt;
    &lt;/initMethod&gt;
    &lt;initMethod name=&quot;addErrorPage&quot;&gt;
        &lt;arg&gt;@org.seasar.framework.exception.SQLRuntimeException@class&lt;/arg&gt;
        &lt;arg&gt;&quot;/errorpage/errorPageHsqldb.html&quot;&lt;/arg&gt;
    &lt;/initMethod&gt;
&lt;/component&gt;
</pre>
<p>org.seasar.jsf.runtime.ErrorPageManagerImplクラスでエラーが発生した場合の画面の遷移先を管理します。今回のErrorPage1RuntimeExceptionの場合は、errorPage1.htmlに遷移します。このようにしてエラーページの設定をjsfErrorPage.diconにまとめて管理することができます。</p>
<p>errorPage1.htmlではm:value="#{requestScope['seasar.jsf.error.message']}"でErrorPage1RuntimeExceptionでセットしたメッセージを表示しています。</p>
<pre>
&lt;body&gt;
&lt;span m:inject=&quot;f:param&quot; m:name=&quot;layoutTitle&quot; m:value=&quot;The page transition with exception1&quot;/&gt;
&lt;span m:inject=&quot;s:insert&quot; m:name=&quot;body&quot;&gt;
<strong>&lt;span m:value=&quot;#{requestScope['seasar.jsf.error.message']}&quot;&gt;error message&lt;/span&gt;</strong>
&lt;/span&gt;
&lt;/body&gt;
</pre>
<p>それでは、pageTran1.htmlのもう一つのボタンを見てみましょう。</p>
<pre>
&lt;input type=&quot;button&quot; value=&quot;The exception due to initialize action&quot; m:action=&quot;pageTran2&quot; 
                onclick=&quot;location.href='pageTran2.html'&quot; m:immediate=&quot;true&quot;/&gt;
</pre>
<p>action属性のpageTran2はWEB-INF/faces-config.xmlでは/errorpage/pageTran2.htmlと定義されています。</p>
<p>pageTran2.htmlを見てみましょう</p>
<pre>
01:&lt;html xmlns:m=&quot;http://www.seasar.org/maya&quot;
02:    <strong>m:action=&quot;#{page2InitAction.initialize}&quot;</strong>
03:    m:extends=&quot;/WEB-INF/layout/layout.html&quot;&gt;
</pre>
<p>2行目のaction属性のActionクラスを見てみましょう。</p>
<pre>
public class Page2InitActionImpl implements Page2InitAction {
    
    public String initialize() {
        throw new ErrorPage2RuntimeException(&quot;errorPage2&quot;);
    }

}
</pre>
<p>この処理も先ほどと同じようにErrorPage2RuntimeExceptionを発生させています。
ErrorPage2RuntimeExceptionはjsfErrorPage.diconを見るとerrorPage2.htmlに遷移するように設定してありますので、
errorPage2.htmlに遷移して設定したメッセージが表示されます。</p>

<h2><a name="employeeManagement">Employee Management</a></h2>
<p>このサンプルの従業員管理アプリケーションでは新規・修正・削除・照会を行います。
このサンプルを動かす前にs2jsf-example/WEB-INF/binにあるrunHsqldb.batでHSQLDBを起動させておいてください。
</p>
<p>s2jsfでは、Actionクラス・Logicクラス・dicon・Dto・Daoという構成でなりたっています。
今回のサンプルは以下のようになっています。</p>
<pre>
・Actionクラス
examples/jsf/action
                  EmployeeConfirmAction.java     (確認処理インターフェース)
                  EmployeeConfirmInitAction.java (確認初期処理Actionインターフェース)
                  EmployeeEditAction.java        (編集処理インターフェース)
                  EmployeeEditInitAction.java    (編集初期処理インターフェース)
                  EmployeeListAction.java        (一覧処理インターフェース) 
                  EmployeeListInitAction.java    (一覧初期処理インタフェース)
                  EmployeeSearchAction.java      (検索処理インターフェース)
                  EmployeeSearchInitAction.java  (検索初期処理インターフェース)

・Action実装クラス                    
examples/jsf/action/impl
                  EmployeeConfirmActionImpl.java     (確認処理実装クラス)
                  EmployeeConfirmInitActionImpl.java (確認初期処理実装クラス)
                  EmployeeEditActionImpl.java        (編集処理実装クラス)
                  EmployeeEditInitActionImpl.java    (編集初期処理実装クラス)
                  EmployeeListActionImpl.java        (一覧処理実装クラス) 
                  EmployeeListInitActionImpl.java    (一覧初期処理実装クラス)
                  EmployeeSearchActionImpl.java      (検索処理実装クラス)
                  EmployeeSearchInitActionImpl.java  (検索初期処理実装クラス)

・ロジッククラス
examples/jsf/logic
                  EmployeeLogic.java (業務ロジックインタフェース)

・ロジック実装クラス
examples/jsf/logic/impl
                  EmployeeLogicImpl.java (業務ロジック実装クラス)

・diconファイル
examples/jsf/dicon
             employee.dicon  (各Actionクラスとロジッククラスの定義ファイル)
             
・Dto
examples/jsf/dto
             EmployeeSearchDto.java (検索画面用Dto)
             EmployeeDto.java       (従業員用Dto)
             DepartmentDto.java     (部署用Dto)

・Dao
examples/jsf/Dao
             DepartmentDtoDao.java  (DEPTテーブルDao)
             EmployeeDtoDao.java    (EMPテーブルDao)
             
             
</pre>
<h3><a name="employeeSearch">employeeSearch.html</a></h3>
<p>それでは、初めのemployeeSearch.htmlから見てみましょう。見ていく順番は以下のようになります。 </p>
<ul>
<li><a href="#EmployeeSearchInitialize">ページの初期処理の説明</a></li>
    <ul>
    <li><a href="#EmployeeSearchInitializeClass">ページの初期処理のクラス</a></li>
    <ul>
        <li><a href="#EmployeeSearchInitializeProperty">プロパティ</a></li>
        <li><a href="#EmployeeSearchInitializeMethod">ページを初期処理するメソッド</a></li>
    </ul>
    </ul>
<li><a href="#EmployeeSearchInitializeView">画面の説明</a></li>
    <ul>
    <li><a href="EmployeeSearchInitializeTagu">タグ</a></li>
    </ul>
<li><a href="#EmployeeSearchAction">Actionクラスの説明</a></li>
    <ul>
    <li><a href="#EmployeeSearchActionClass">Actionクラス</a></li>
    <ul>
        <li><a href="#EmployeeSearchActionProperty">プロパティ</a></li>
        <li><a href="#EmployeeSearchActionMethod">Actionクラスのメソッド(MethodBinding)</a></li>
    </ul>
    </ul>
</ul>

<h4><a name="EmployeeSearchInitialize">ページの初期処理の説明</a></h4>
<pre>
01:&lt;html xmlns:m=&quot;http://www.seasar.org/maya&quot;
02:    <strong>m:action=&quot;#{employeeSearchInitAction.initialize}&quot;</strong>
03:    m:extends=&quot;/WEB-INF/layout/layout.html&quot;&gt;
</pre>
<p>
2行目のaction属性で、ページを初期化するコンポーネント(employeeSearchInitAction)とそのメソッド(initialize)を指定しています。
この初期処理では、下記selectタグのitems属性のdepartmentDtoListにDAOから取得したJavaBeanのListをセットします。
</p>
<pre>
71:&lt;select id=&quot;deptno&quot; m:value=&quot;#{employeeSearchDto.deptno}&quot;
72:    m:items=&quot;<strong>#{departmentDtoList}&quot;</strong>
73:    m:itemValue=&quot;deptno&quot;
74:    m:itemLabel=&quot;dname&quot;
75:    m:nullLabel=&quot;Please select&quot;&gt;
76:    &lt;option value=&quot;&quot;&gt;Please select&lt;/option&gt;
77:    &lt;option value=&quot;10&quot;&gt;ACCOUNTING&lt;/option&gt;
78:    &lt;option value=&quot;20&quot;&gt;RESEARCH&lt;/option&gt;
79:    &lt;option value=&quot;30&quot;&gt;SALES&lt;/option&gt;
80:    &lt;option value=&quot;40&quot;&gt;OPERATIONS&lt;/option&gt;
81:&lt;/select&gt;
</pre>

<h5><a name="EmployeeSearchInitializeClass">ページの初期処理のクラス</a></h5>
<p>
employeeSearchInitActionは、<a href="#AutoRegisterForAction">Action自動登録設定</a>によってS2Containerに登録されています。
<ul>
<li>クラスはexamples.jsf.action.impl.EmployeeSearchInitActionImplです</li>
<li>instanceモードはrequestです</li>
<li>アスペクトとしてactionInterceptorChainが登録されています</li>
</ul>
actionInterceptorChainの中のactionThrowsInterceptorによって、発生した例外のメッセージは下記のメッセージタグにセットされます。
<pre>
&lt;span m:inject=&quot;h:messages&quot; m:globalOnly=&quot;true&quot; m:class=&quot;error&quot;/&gt;
</pre>
examples.jsf.action.impl.EmployeeSearchInitActionImplを見ていきましょう。
</p>

<h5><a name="EmployeeSearchInitializeProperty">プロパティ</a></h5>
<p>初期処理のActionクラスは次のプロパティを持っています。</p>
<pre>
public class EmployeeSearchInitActionImpl implements EmployeeSearchInitAction {

    <strong>private EmployeeLogic employeeLogic;
    private List departmentDtoList;</strong>
                  :
}
</pre>
<p>
EmployeeLogicはインターフェースなので、S2ContainerによってEmployeeLogicを実装したクラスが自動的に設定されます。
EmployeeLogicを実装したクラスはexamples.jsf.logic.impl.EmployeeLogicImplです。
app.diconでの設定によりS2Containerへ登録されています。
</p>
<p>
<a href="#AutoRegisterForLogic">Logic自動登録</a>で解説したようにLogicにはlogicInterceptorChainが指定されており、
logicInterceptorChainの中のj2ee.requiredTxによって、トランザクションが自動制御されます。
</p>
<p>
EmployeeLogicImplは以下の2つのsetterメソッドに対してDAOを自動バインディングしてセットします。
DAOの詳しい説明は<a href="http://s2dao.seasar.org/ja/index.html">S2Dao</a>を参照してください。
<pre>
public class EmployeeLogicImpl implements EmployeeLogic {
    private EmployeeDtoDao employeeDtoDao;
    private DepartmentDtoDao departmentDtoDao;

    <strong>public void setEmployeeDtoDao(EmployeeDtoDao employeeDtoDao) {
        this.employeeDtoDao = employeeDtoDao;
    }</strong>
    
    <strong>public void setDepartmentDtoDao(DepartmentDtoDao departmentDtoDao) {
        this.departmentDtoDao = departmentDtoDao;
    }</strong>
                        :
                        :
</pre>
<p>EmployeeDtoDaoではBEANアノテーションでexamples.jsf.dto.EmployeeDtoを定義しています。</p>
<pre>
public interface EmployeeDtoDao {
    <strong>public Class BEAN = EmployeeDto.class;</strong>
                        :
}
</pre>
<p>
BEANアノテーションで指定しているexamples.jsf.dto.EmployeeDtoはexamples.jsf.entity.Employeeのサブクラスで、
このexamples.jsf.entity.EmployeeでTABLEアノテーションでEMPテーブルとの関連付けを行っています。</p>
<pre>
public class Employee implements Serializable {
    <strong>public static final String TABLE = "EMP";</strong>
                        :
}
</pre>
<p>
examples.jsf.dto.EmployeeDtoはプロパティdnameとそのsetter/getterを追加したもので、
これはDepartment.dname用のものです。
もう一方のDepartmentDtoDaoも同じようにBEANアノテーションでexamples.jsf.dto.DepartmentDtoを定義しています。
</p>
<pre>
public interface DepartmentDtoDao {
    <strong>public Class BEAN = DepartmentDto.class;</strong>
                        :
}
</pre>
<p>
BEANアノテーションで指定しているexamples.jsf.dto.DepartmentDtoはexamples.jsf.entity.Departmentのサブクラスで、
このexamples.jsf.entity.DepartmentでTABLEアノテーションでDEPTテーブルとの関連付けを行っています。
</p>
<pre>
public class Department implements Serializable {
    <strong>public static final String TABLE = "DEPT";</strong>
                        :
}
</pre>
<p>
これら2つのDAOはapp.diconでの設定によりS2Containerへ登録されています。
</p>
<p>
<a href="#AutoRegisterForDao">DAO自動登録</a>で解説したようにDAOにはdaoInterceptorChainが指定されています。
daoInterceptorChainの中のdao.interceptorによって、EmployeeDtoDao・DepartmentDtoDaoはインタフェースに対して
実装クラスが自動的に生成されます。
</p>

<h5><a name="EmployeeSearchInitializeMethod">ページを初期処理するメソッド</a></h5>
<p>
EmployeeSearchInitActionImpl#initialize()のメソッドでは、
EmployeeLogicImpl#getAllDepartments()の戻り値(DepartmentDtoのList)をプロパティdepartmentDtoListにセットします。
getterメソッドとしてgetDepartmentDtoListがあるので、このプロパティが自動的にrequestスコープの属性として保存されます。
そのためセレクトタグのitem属性のdepartmentDtoListにセットされます。
</p>
<pre>
public class EmployeeSearchInitActionImpl implements EmployeeSearchInitAction {
                  :
    <strong>public String initialize() {
        departmentDtoList = employeeLogic.getAllDepartments();
        return null;
    }</strong>
}
</pre>

<h4><a name="EmployeeSearchInitializeView">画面の説明</a></h4>
<p>この画面(employeeSearch.html)の各入出力用のタグを見ていきましょう。
各入出力用のタグはJavaBeans(employeeSearchDto)のプロパティを連動させています。
</p>
<h5><a name="EmployeeSearchInitializeTagu">タグの説明</a></h5>
<p>EmployeeNoのタグは次のようになっています。</p>
<pre>&lt;tr&gt;
    &lt;td class=&quot;label&quot;&gt;EmployeeNo&lt;/td&gt;
    &lt;td&gt;&lt;input type=&quot;text&quot; id=&quot;empno&quot;
            m:value=&quot;#{employeeSearchDto.empno}&quot;
            class=&quot;right&quot;&gt;
            &lt;span m:inject=&quot;s:validator&quot; m:binding=&quot;#{empnoRangeValidator}&quot;/&gt;
        &lt;/input&gt;
        &lt;span m:inject=&quot;h:message&quot; m:for=&quot;empno&quot; m:class=&quot;error&quot;/&gt;
    &lt;/td&gt;
&lt;/tr&gt;
</pre>
<p>このvalidatorタグですがサンプルの<a href="#validator">validator.html</a>と同じようにvalidatorタグのbinding属性でempnoRangeValidatorを指定しています。このバリデータは、examples/jsf/dicon/allvalidator.diconで次のように定義されています。</p>
<pre>
&lt;component name=&quot;empnoRangeValidator&quot; class=&quot;javax.faces.validator.LongRangeValidator&quot;&gt;
    &lt;property name=&quot;maximum&quot;&gt;10000&lt;/property&gt;
&lt;/component&gt;
</pre>
<p>EmployeeName, Job, Managerも特に変わった設定はありません。HireDateではvalidatorが無いのにmessageタグが用意されています。</p>
<pre>
&lt;tr&gt;
    &lt;td class=&quot;label&quot;&gt;HireDate&lt;/td&gt;
    &lt;td&gt;&lt;input id=&quot;fromHiredate&quot; type=&quot;text&quot;
            m:value=&quot;#{employeeSearchDto.fromHiredate}&quot;/&gt;
        &lt;span m:inject=&quot;h:message&quot; m:for=&quot;fromHiredate&quot; m:class=&quot;error&quot;/&gt;～
        &lt;input id=&quot;toHiredate&quot; type=&quot;text&quot;
            m:value=&quot;#{employeeSearchDto.toHiredate}&quot;/&gt;
        &lt;span m:inject=&quot;h:message&quot; m:for=&quot;toHiredate&quot; m:class=&quot;error&quot;/&gt;
    &lt;/td&gt;
&lt;/tr&gt;
</pre>
<p>
これはJSFの標準機能でJavaBeanのプロパティの型をString型と相互に変換する標準のコンバータを適用してくれます。
標準コンバータの呼び出しでもvalidationが行われるためコンバータが解釈できなければエラーメッセージがセットされます。
Salaryも同様に標準のコンバータが適応されます。
</br>
ただし、このs2jsf-exampleではJavaBeanのプロパティの型がjava.util.Dateの場合はorg.seasar.jsf.convert.S2DateTimeConverterを使用するようにしてあります。
この定義はfaces-config.xmlで次のように定義してあります。
</p>
<pre>
&lt;converter&gt;
    &lt;converter-for-class&gt;java.util.Date&lt;/converter-for-class&gt;
    &lt;converter-class&gt;org.seasar.jsf.convert.S2DateTimeConverter&lt;/converter-class&gt;
&lt;/converter&gt;
</pre>
<p>
次にcreate・searchボタンを見ていきましょう。
action属性でメソッドを呼び出しています(MethodBinding)。
onclick属性のlocation.href='employeeEdit.html'の部分はプレビュー用です。
</p>
<pre>
&lt;input type=&quot;button&quot; value=&quot;create&quot;
    m:action=&quot;#{employeeSearchAction.goEditForCreate}&quot;
    onclick=&quot;location.href='employeeEdit.html'&quot;/&gt;
&lt;input type=&quot;button&quot; value=&quot;search&quot;
    m:action=&quot;#{employeeSearchAction.checkSearchCount}&quot;
    onclick=&quot;location.href='employeeList.html'&quot;/&gt;
</pre>

<h4><a name="EmployeeSearchAction">Actionクラスの説明</a></h4>
<p>createボタンのaction属性に記述されているemployeeSearchActionを見ていきましょう。</p>

<h5><a name="EmployeeSearchActionClass">Actionクラス</a></h5>
<p>
employeeSearchActionは、<a href="#AutoRegisterForAction">Action自動登録設定</a>によってS2Containerに登録されています。
<ul>
<li>クラスはexamples.jsf.action.impl.EmployeeSearchActionImplです</li>
<li>instanceモードはrequestです</li>
<li>アスペクトとしてactionInterceptorChainが登録されています</li>
</ul>
examples.jsf.action.impl.EmployeeSearchActionImplクラスを見ていきましょう。
</p>

<h5><a name="EmployeeSearchActionProperty">プロパティ</a></h5>
<p>examples.jsf.action.impl.EmployeeSearchActionImplは以下のプロパティを持っています。</p>
<pre>
public class EmployeeSearchActionImpl implements EmployeeSearchAction {
    private EmployeeLogic employeeLogic;
    private EmployeeSearchDto employeeSearchDto;
    <strong>private ProcessModeDto processModeDto;</strong>
                    :
}
</pre>
<p>
examples.jsf.dto.ProcessModeDtoは状態を表すDTOです。
<a href="#AutoRegisterForDto">DTO自動登録設定</a>によって、S2Containerに登録されています。
</p>
<p>
ProcessModeDtoはプロパティとしてprocessModeがあるだけのクラスです。
そのインスタンスがsessionで管理されています。
app.diconではrequestスコープへ登録するよう設定されていますが、
ProcessModeDtoのCOMPONENTアノテーションでapp.diconの設定を上書きしています。
<pre>
public class ProcessModeDto {
    <strong>public static final String COMPONENT = "instance = session";</strong>
                    :
</pre>
</p>

<h5><a name="EmployeeSearchActionMethod">Actionクラスのメソッド(MethodBinding)</a></h5>
<p>それでは、createボタンが押されたときに実行されるexamples.jsf.action.impl.EmployeeSearchActionImplのgoEditForCreate()を見てみましょう。</p>
<pre>
public String goEditForCreate() {
    processModeDto.setProcessMode(Constants.CREATE_MODE);
    return &quot;employeeEdit&quot;;
}
</pre>
<p>Constants(examples.jsf.common.Constants)は以下のように処理の状態を表す定数を定義しただけのインタフェースです。</p>
<pre>
public interface Constants {
    public int CREATE_MODE = 1;
    public int UPDATE_MODE = 2;
    public int DELETE_MODE = 3;
    public int REFER_MODE = 4;
}
</pre>
<p>ProcessModeDtoに「CREATE_MODE」という状態が記録され、最後に"employeeEdit"が返されます。
faces-config.xmlを見ると、employeeEditは/employee/employeeEdit.htmlと定義されています。
<pre>
&lt;navigation-rule&gt;
    &lt;navigation-case&gt;
        &lt;from-outcome&gt;employeeEdit&lt;/from-outcome&gt;
        &lt;to-view-id&gt;/employee/employeeEdit.html&lt;/to-view-id&gt;
    &lt;/navigation-case&gt;
&lt;/navigation-rule&gt;
</pre>

<h3><a name="employeeEdit">employeeEdit.html</a></h3>
<p>/employee/employeeEdit.htmlを見てみましょう。見ていく順番は以下のようになります。</p>
<ul>
<li><a href="#EmployeeEditInitialize">ページの初期処理の説明</a></li>
    <ul>
    <li><a href="#EmployeeEditInitializeClass">ページの初期処理のクラス</a></li>
    <ul>
        <li><a href="#EmployeeEditInitializeProperty">プロパティ</a></li>
        <li><a href="#EmployeeEditInitializeMethod">ページを初期処理するメソッド</a></li>
    </ul>
    </ul>
<li><a href="#EmployeeEditView">画面の説明</a></li>
    <ul>
    <li><a href="#EmployeeEditTagu">タグ</a></li>
    </ul>
<li><a href="#EmployeeEditAction">Actionクラスの説明</a></li>
    <ul>
    <li><a href="#EmployeeEditActionClass">Actionクラス</a></li>
    <ul>
        <li><a href="#EmployeeEditActionProperty">プロパティ</a></li>
        <li><a href="#EmployeeEditActionMethod">Actionクラスのメソッド(MethodBinding)</a></li>
    </ul>
    </ul>
</ul>
<h4><a name="EmployeeEditInitialize">ページの初期処理の説明</a></h4>
<pre>
&lt;html xmlns:m=&quot;http://www.seasar.org/maya&quot;
    <strong>m:action=&quot;#{employeeEditInitAction.initialize}&quot;</strong>
    m:extends=&quot;/WEB-INF/layout/layout.html&quot;&gt;
</pre>
<p>2行目のaction属性でページの初期処理をするメソッドを指定しています。</a>

<h5><a name="EmployeeEditInitializeClass">ページの初期処理のクラス</a></h5>
<p>
employeeEditInitActionは、<a href="#AutoRegisterForAction">Action自動登録設定</a>によってS2Containerに登録されています。
<ul>
<li>クラスはexamples.jsf.action.impl.EmployeeEditInitActionImplです</li>
<li>instanceモードはrequestです</li>
<li>アスペクトとしてactionInterceptorChainが登録されています</li>
</ul>
examples.jsf.action.impl.EmployeeEditInitActionImplを見ていきましょう。
</p>

<h5><a name="EmployeeEditInitializeProperty">プロパティ</a></h5>
<p>examples.jsf.action.impl.EmployeeEditInitActionImplクラスは以下のプロパティを持っています。</p>
<pre>
public class EmployeeEditInitActionImpl implements EmployeeEditInitAction {
    private EmployeeLogic employeeLogic;
    private Integer empno;
    private ProcessModeDto processModeDto;
    private EmployeeDto employeeDto;
    private List departmentDtoList;
                :
}
</pre>
<p>
empnoは単なるプロパティで、ProcessModeDtoは前に書いたようにプログラムの状態管理です。
最後のdepartmentDtoListはsetterメソッドが無いので、EmployeeEditInitActionImpl生成時点では何も行われません。
action属性で指定されたinitialize()の中でセットされます。そのinitialize()は次のようになっています。
</p>

<h5><a name="EmployeeEditInitializeMethod">ページを初期処理するメソッド</a></h5>
<p>
getAllDepartments()でテーブルDEPTの全レコードを取得しています。
次のif文では、現在の状態がUPDATE_MODE(編集状態)ならempnoをキーにテーブルEMPを検索した結果をemployeeDtoへ設定します。
これをHTMLファイルでValueBindingすることにより、値が自動的に画面表示されます。
今回はCREATE_MODEなので検索は行われずemployeeDtoは空になります。
</p>
<pre>
public String initialize() {
    departmentDtoList = employeeLogic.getAllDepartments();
    if (processModeDto.getProcessMode() == Constants.UPDATE_MODE) {
        employeeDto = employeeLogic.getEmployeeDto(empno);
    }
    return null;
}
</pre>
<h4><a name="EmployeeEditView">画面の説明</a></h4>
<p>この画面(employeeEdit.html)の各入出力用のタグを見ていきましょう。
各入出力用のタグはJavaBeans(employeeDto)のプロパティを連動させています。
</p>

<h5><a name="EmployeeEditTagu">タグの説明</a></h5>
<p>画面に表示させる処理モードの表示方法は次のようになります。
</p>
<pre>
&lt;span m:value=&quot;Create&quot;
    <strong>m:rendered=&quot;#{processModeDto.processMode == 1}&quot;</strong>
    m:class=&quot;display&quot; class=&quot;notdisplay&quot;&gt;
    Create
&lt/span&gt;
&lt;span m:value=&quot;Edit&quot;
    m:rendered=&quot;#{processModeDto.processMode == 2}&quot;&gt;
    Edit
&lt;/span&gt;
</pre>
<p>renderedは条件分岐で以下のように設定します。</p>
<pre>
&lt;span m:value=&quot;値1&quot; m:rendered=&quot;条件式1&quot;&gt;値2&lt;/span&gt;
&lt;span m:rendered=&quot;条件式2&quot;&gt;値3&lt;/span&gt;
</pre>
<p>上の場合、このspanタグの評価結果は</p>
<ul>
<li>条件式1がtrueなら値1。falseなら何も返さない。値2はプレビュー用。</li>
<li>条件式2がtrueなら値3。falseなら何も返さない。値3プレビューでも使われる。</li>
</ul>
<p>値3にはまた別なspanタグを書いたりしてネストすることもできます。
最初のspanタグはprocessModeDto.processMode == 1ならvalue属性の"Create"になります。
spanタグで囲まれている方の"Create"はプレビュー用です。
spanタグのm:classはrendered = true(つまりS2JSF環境で実行して条件が成立したとき)使われるCSSのclassで、
ただのclass(notdisplay)はプレビュー用のものとなります。
プレビュー用のclass(notdisplay)はCreateを表示させないようにしています。
プレビューで見たときCreateとEditの両方が表示されてしまうためです。
またm:class="display"を記述しておかないと、S2JSF環境で実行した場合にプレビュー用のclass(notdisplay)が適応されて表示されなくなってしまいます。
</p>
<p>次に出てくるhiddenタグを見てみましょう。</p>
<pre>
&lt;input type=&quot;hidden&quot; m:value=&quot;#{employeeDto.versionNo}&quot;
    m:rendered=&quot;#{processModeDto.processMode == 2}&quot;/&gt;
&lt;input type=&quot;hidden&quot; m:value=&quot;#{employeeDto.empno}&quot;
    m:rendered=&quot;#{processModeDto.processMode == 2}&quot;/&gt;
</pre>
<p>これもrenderedを使用してUPDATE_MODEの時は、これらの値をhiddenで保持します。</p>
<p>次にEmployeeNo(主キーempno)用のフィールドを見ていきましょう。</p>
<pre>
&lt;td class=&quot;label&quot;&gt;EmployeeNo&lt;/td&gt;
&lt;td&gt;
    &lt;input id=&quot;empno&quot; type=&quot;text&quot;
        m:value=&quot;#{employeeDto.empno}&quot;
        m:class=&quot;display right&quot;
        class=&quot;notdisplay&quot;
        m:required=&quot;true&quot;
        m:rendered=&quot;#{processModeDto.processMode == 1}&quot;/&gt;
    &lt;span m:inject=&quot;h:message&quot; m:for=&quot;empno&quot; m:class=&quot;error&quot;
        m:rendered=&quot;#{processModeDto.processMode == 1}&quot;/&gt;
    &lt;div class=&quot;right&quot; m:rendered=&quot;#{processModeDto.processMode == 2}&quot;&gt;
        &lt;span m:value=&quot;#{employeeDto.empno}&quot;&gt;7788&lt;/span&gt;
    &lt;/div&gt;
&lt;/td&gt;
</pre>
<p>このinputタグはrenderedでCREATE_MODEの時だけ生成されます。またrequired属性がtrueなので入力必須となります。messageも同様にCREATE_MODEの時だけ生成されるようになっています。UPDATE_MODEで生成されるのは、その後のdivタグの部分となります。 </p>
<p>EmployeeName、Job、Manager、HireDate、Salary、Commissionの各フィールドはemployeeDtoを連動するようになっています。</p>
<pre>
&lt;td class=&quot;label&quot;&gt;EmployeeName&lt;/td&gt;
&lt;td&gt;&lt;input type=&quot;text&quot; m:value=&quot;#{employeeDto.ename}&quot; value=&quot;SCOTT&quot;/&gt;&lt;/td&gt;
</pre>
<p>CREATE_MODEの場合、各プロパティには何もセットされていない(デフォルト値)。 UPDATE_MODEの場合、該当EMPレコードの内容が表示されるようになっています。何かが表示されるのは、UPDATE_MODEのときだけとなります。</p>
<p>employeeEdit.htmlの残りボタンを見ていきましょう。</p>
<pre>
&lt;input type=&quot;button&quot; value=&quot;confirm&quot; m:action=&quot;#{employeeEditAction.goConfirm}&quot;
    onclick=&quot;location.href='employeeConfirm.html'&quot;/&gt;
&lt;input type=&quot;button&quot; value=&quot;previous&quot;
    m:action=&quot;#{employeeEditAction.goPrevious}&quot;
    <strong>m:immediate=&quot;true&quot;</strong>
    onclick=&quot;location.href='employeeList.html'&quot;/&gt;
</pre>
<p>immediate="true"を指定することでバリデーションをかけないでページ遷移が可能となります。</p>

<h4><a name="EmployeeEditAction">Actionクラスの説明</a></h4>
<p>action属性のemployeeEditActionを見ていきましょう。</p>

<h4><a name="EmployeeEditActionClass">Actionクラス</a></h4>
<p>
employeeEditActionは、<a href="#AutoRegisterForAction">Action自動登録設定</a>によってS2Containerに登録されています。
<ul>
<li>クラスはexamples.jsf.action.impl.EmployeeEditActionImplです</li>
<li>instanceモードはrequestです</li>
<li>アスペクトとしてactionInterceptorChainが登録されています</li>
</ul>
examples.jsf.action.impl.EmployeeEditActionImplクラスを見ていきましょう。
</p>

<h5><a name="EmployeeEditActionProperty">プロパティ</a></h5>
<p>examples.jsf.action.impl.EmployeeEditActionImplは以下のプロパティを持っています。</p>
<pre>
public class EmployeeEditActionImpl implements EmployeeEditAction {
    private EmployeeLogic employeeLogic;
    private ProcessModeDto processModeDto;
    private EmployeeDto employeeDto;
                ：
}
</pre>
<p>
EmployeeLogicはテーブルEMPを操作するインタフェース。
その実装クラスEmployeeLogicImplがセットされます。
ProcessModeDtoはプログラムの状態を管理するDTOです。
EmployeeDtoはemployeeEdit.htmlでは各フィールドをemployeeDtoのプロパティにValueBindingしていて、
そのbindされたemployeeDtoがrequestスコープに保存されています。
</p>

<h4><a name="EmployeeEditActionMethod">Actionクラスのメソッド(MethodBinding)</a></h4>
<p>それではボタンのMethodbindingのemployeeEditAction.goPreviousから見てみましょう。</p>
<pre>
public String goPrevious() {
    switch (processModeDto.getProcessMode()) {
        case Constants.CREATE_MODE :
            return &quot;employeeSearch&quot;;
        case Constants.UPDATE_MODE :
            return &quot;employeeList&quot;;
        default:
            return null;
    }
}
</pre>
<p>action属性で指定されているgoPrevious()は、現在の状態に合わせて戻り先を決めているだけです。
またimmediate="true"を指定していたので入力内容を反映せずにページ遷移が可能となります。
残りのMethodbindingのemployeeEditAction.goConfirm()は次のようになっています。
</p>
<pre>
public String goConfirm() {
    if (processModeDto.getProcessMode() == Constants.CREATE_MODE
            && <strong>employeeLogic.existEmployee(employeeDto.getEmpno())</strong>) {
        throw new EmployeeAlreadyExistRuntimeException(employeeDto
                .getEmpno().intValue());
    }
    return "employeeConfirm";
}
</pre>
<p>まずexistEmployee()はEmployeeLogicの以下のメソッドを呼んでいます。</p>
<pre>
public boolean existEmployee(Integer empno) {
    return employeeDtoDao.getEmployeeDto(empno) != null;
}
</pre>
<p>引数empnoをキーにテーブルEMPを検索し、該当レコードをjava.util.Listに格納して、この戻り値がnullでない場合trueを返します。
呼び出し元のif文では、これを使ってCREATE_MODEで同じempnoを持つレコードがテーブルEMPにあれば例外EmployeeAlreadyExistRuntimeExceptionをスローしています。
</p>
<p>EmployeeAlreadyExistRuntimeExceptionはjava.lang.RuntimeExceptionのサブクラス(正確には間にexamples.jsf.exceptionAppRuntimeExceptionが入る)なのでthrowsを書く必要がありません。
結果「従業員(xxxx)は既に存在します」というメッセージとして表示されます。
これはこのemployeeEditActionにactionInterceptorChainが適用されるからです。
empnoが重複していなければ"employeeConfirm"が返され、/employee/employeeConfirm.htmlに遷移します。
</p>

<h3><a name="employeeConfirm">employeeConfirm.html</a></h3>
<p>
employeeSearch.htmlでcreateボタンが押された後に表示されるemployee/employeeConfirm.htmlを見ていきましょう。
見ていく順番は以下のようになります。
</p>
<ul>
<li><a href="#EmployeeConfirmInitialize">ページの初期処理の説明</a></li>
    <ul>
    <li><a href="#EmployeeConfirmInitializeClass">ページの初期処理のクラス</a></li>
    <ul>
        <li><a href="#EmployeeConfirmInitializeProperty">プロパティ</a></li>
        <li><a href="#EmployeeConfirmInitializeMethod">ページを初期処理するメソッド</a></li>
    </ul>
    </ul>
<li><a href="#EmployeeConfirmView">画面の説明</a></li>
    <ul>
    <li><a href="#EmployeeConfirmTagu">タグ</a></li>
    </ul>
<li><a href="#EmployeeConfirmAction">Actionクラスの説明</a></li>
    <ul>
    <li><a href="#EmployeeConfirmActionClass">Actionクラス</a></li>
    <ul>
        <li><a href="#EmployeeConfirmActionProperty">プロパティ</a></li>
        <li><a href="#EmployeeConfirmActionMethod">Actionクラスのメソッド(MethodBinding)</a></li>
    </ul>
    </ul>
</ul>
<h4><a name="EmployeeConfirmInitialize">ページの初期処理の説明</a></h4>

<pre>
01:&lt;html xmlns:m=&quot;http://www.seasar.org/maya&quot;
02:    <strong>m:action=&quot;#{employeeConfirmInitAction.initialize}&quot;</strong>
03:    m:extends=&quot;/WEB-INF/layout/layout.html&quot;&gt;
</pre>
<p>2行目のaction属性でページを初期化するメソッドを指定しています。</p>

<h5><a name="EmployeeConfirmInitializeClass">ページの初期処理のクラス</a></h5>
<p>
employeeConfirmInitActionは、<a href="#AutoRegisterForAction">Action自動登録設定</a>によってS2Containerに登録されています。
<ul>
<li>クラスはexamples.jsf.action.impl.EmployeeConfirmInitActionImplです</li>
<li>instanceモードはrequestです</li>
<li>アスペクトとしてactionInterceptorChainが登録されています</li>
</ul>
examples.jsf.action.impl.EmployeeConfirmInitActionImplを見ていきましょう。
</p>

<h5><a name="EmployeeConfirmInitializeProperty">プロパティ</a></h5>
<p>examples.jsf.action.impl.EmployeeConfirmInitActionImplのプロパティは以下のようになっています。</p>
<pre>
public class EmployeeConfirmInitActionImpl implements EmployeeConfirmInitAction {
    private EmployeeLogic employeeLogic;
    private EmployeeDto employeeDto;
            :
}
</pre>
<p>
EmployeeLogicはテーブルEMPを操作するインタフェース定義で、その実装クラス(EmployeeLogicImp)がセットされます。
EmployeeDtoは、このemployeeConfirm.htmlの場合、前画面のemployeeEdit.htmlの各フィールドでValueBindingされた結果が入っています。
</p>

<h5><a name="EmployeeConfirmInitializeMethod">ページを初期処理するメソッド</a></h5>
<p>初期化処理(initialize())は次のようになっています。</p>
<pre>
public String initialize() {
    if (employeeDto.getDeptno() != null) {
        String dname = employeeLogic.getDname(employeeDto.getDeptno());
        employeeDto.setDname(dname);
    }
    return null;
}
</pre>
<p>employeeDto.getDeptno()で返されるのは、employeeEdit.htmlのDepartmentコンボボックスで選択された値であり、それに対応する選択肢の名称(つまりdname)は一緒にValueBindingで取り出せないので、ここで取得しています。</p>
<h4><a name="EmployeeConfirmView">画面の説明</a></h4>
<p>それでは/employee/employeeConfirm.htmlのbody部分を見ていきましょう。<p>
<h5><a name="EmployeeConfirmTagu">タグの説明</a></h5>
<p>まず初めにrenderedが４つあります。このemployeeConfirm.htmlは全モード共通で使われる画面のためです。</p>
<pre>
&lt;span m:value=&quot;Create&quot;
    m:rendered=&quot;#{processModeDto.processMode == 1}&quot;
    m:class=&quot;display&quot; class=&quot;notdisplay&quot;&gt;
    Create
&lt;/span&gt;
&lt;span m:value=&quot;Edit&quot;
    m:rendered=&quot;#{processModeDto.processMode == 2}&quot;&gt;
    Edit
&lt;/span&gt;
&lt;span m:value=&quot;Delete&quot;
    m:rendered=&quot;#{processModeDto.processMode == 3}&quot;
    m:class=&quot;display&quot; class=&quot;notdisplay&quot;&gt;
    Delete
&lt;/span&gt;
&lt;span m:value=&quot;Inquire&quot;
    m:rendered=&quot;#{processModeDto.processMode == 4}&quot;
    m:class=&quot;display&quot; class=&quot;notdisplay&quot;&gt;
    Inquire
&lt;/span&gt;
</pre>
<p>その次に以下のようにhiddenタグが設定されています。</p>
<pre>
&lt;input type=&quot;hidden&quot; m:value=&quot;#{employeeDto.versionNo}&quot;/&gt;
&lt;input type=&quot;hidden&quot; m:value=&quot;#{employeeDto.empno}&quot;/&gt;
&lt;input type=&quot;hidden&quot; m:value=&quot;#{employeeDto.ename}&quot;/&gt;
&lt;input type=&quot;hidden&quot; m:value=&quot;#{employeeDto.job}&quot;/&gt;
&lt;input type=&quot;hidden&quot; m:value=&quot;#{employeeDto.mgr}&quot;/&gt;
&lt;input type=&quot;hidden&quot; m:value=&quot;#{employeeDto.hiredate}&quot;/&gt;
&lt;input type=&quot;hidden&quot; m:value=&quot;#{employeeDto.sal}&quot;/&gt;
&lt;input type=&quot;hidden&quot; m:value=&quot;#{employeeDto.comm}&quot;/&gt;
&lt;input type=&quot;hidden&quot; m:value=&quot;#{employeeDto.deptno}&quot;/&gt;
&lt;input type=&quot;hidden&quot; m:value=&quot;#{employeeDto.dname}&quot;/&gt;
</pre>
<p>このemployeeConfirm.htmlではemployeeDtoにセットされている値、つまり前の画面で入力された値を</p>
<pre>
&lt;td class=&quot;label&quot;&gt;EmployeeNo&lt;/td&gt;
&lt;td class=&quot;right&quot;&gt;&lt;span m:value=&quot;#{employeeDto.empno}&quot;&gt;7788&lt;/span&gt;&lt;/td&gt;
</pre>
<p>といった単なる文字列で表示するため、次の画面に(employeeDtoの内容を)渡せないのでhiddenを使ってValueBindingしています。</p>
<p>最後にボタンの定義を見ていきましょう。</p>
<pre>
&lt;input type=&quot;button&quot; value=&quot;store&quot;
    m:action=&quot;#{employeeConfirmAction.store}&quot;
    m:rendered=&quot;#{processModeDto.processMode != 4}&quot;
    onclick=&quot;location.href='employeeSearch.html'&quot;/&gt;
&lt;input type=&quot;button&quot; value=&quot;previous&quot;
    m:action=&quot;#{employeeConfirmAction.goPrevious}&quot;
    onclick=&quot;location.href='employeeEdit.html'&quot;/&gt;
</pre>
<p>storeはrenderedの条件式がprocessModeDto.processMode != 4 なので、CREATE_MODE, UPDATE_MODE, DELETE_MODEのとき表示されます。</p>

<h4><a name="EmployeeConfirmAction">Actionクラスの説明</a></h4>
<p>action属性のemployeeConfirmActionを見ていきましょう。</p>

<h4><a name="EmployeeConfirmActionClass">Actionクラス</a></h4>
<p>
employeeConfirmActionは、<a href="#AutoRegisterForAction">Action自動登録設定</a>によってS2Containerに登録されています。
<ul>
<li>クラスはexamples.jsf.action.impl.EmployeeConfirmActionImplです</li>
<li>instanceモードはrequestです</li>
<li>アスペクトとしてactionInterceptorChainが登録されています</li>
</ul>
examples.jsf.action.impl.EmployeeConfirmActionImplクラスを見ていきましょう。
</p>

<h5><a name="EmployeeConfirmActionProperty">プロパティ</a></h5>
<p>EmployeeConfirmActionImplは以下のプロパティを持っています。</p>
<pre>
public class EmployeeConfirmActionImpl implements EmployeeConfirmAction {
    private EmployeeLogic employeeLogic;
    private ProcessModeDto processModeDto;
    private EmployeeDto employeeDto;
                :
}
</pre>
<p>EmployeeLogicはインタフェースで実際はEmployeeLogicImplというテーブルEMPに対する操作を実装したクラスのインスタンスがセットされます。ProcessModeDtoはプログラムの状態を管理用。
EmployeeDtoには前画面から渡されたデータが入っています。</p>
<h4><a name="EmployeeConfirmActionMethod">Actionクラスのメソッド(MethodBinding)</a></h4>
<p>storeボタンが押されたとき呼び出されるEmployeeLogic#store()を見てみましょう。</p>
<pre>
public String store() {
    switch (processModeDto.getProcessMode()) {
        case Constants.CREATE_MODE :
            employeeLogic.insert(employeeDto);
            break;
        case Constants.UPDATE_MODE :
            employeeLogic.update(employeeDto);
            break;
        case Constants.DELETE_MODE :
            employeeLogic.delete(employeeDto);
            break;
    }
    return "employeeSearch";
}
</pre>
<p>現在の処理モードに合わせてメソッドを呼び分けています。EmployeeLogicImpl側のメソッド定義は次のようになっています。</p>
<pre>
public void insert(EmployeeDto dto) {
    employeeDtoDao.insert(dto);
}

public void update(EmployeeDto dto) {
    employeeDtoDao.update(dto);
}

public void delete(EmployeeDto dto) {
    employeeDtoDao.delete(dto);
}
</pre>
<p>EmployeeDtoDao経由でS2Daoを使用して処理を行っています。</p>
<pre>
public void insert(EmployeeDto dto);
public void update(EmployeeDto dto);
public void delete(EmployeeDto dto);
</pre>
<p>これだけでS2Daoは更新系SQLを自動的に生成して実行してくれます。</p>
<p>previousボタンで呼び出されるgoPrevious()は単に次の表示ページを決めるための文字列を返しているだけです。</p>
<pre>
public String goPrevious() {
    switch (processModeDto.getProcessMode()) {
        case Constants.CREATE_MODE :
        case Constants.UPDATE_MODE :
            return &quot;employeeEdit&quot;;
        default:
            return &quot;employeeList&quot;;
    }
}
</pre>
<p>いままでがemployeeSearch.htmlのcreateボタンを押されて始まる一連の処理となります。
</p>
<p>
次は同じくemployeeSearch.htmlにあるsearchボタンが押されたときの処理を見てみましょう。</p>
<pre>
&lt;input type=&quot;button&quot; value=&quot;search&quot;
    m:action=&quot;#{employeeSearchAction.checkSearchCount}&quot;
    onclick=&quot;location.href='employeeList.html'&quot;/&gt;
</pre>
<p>employeeSearchActionについてはこちらを参照してください。このボタンが押されるとEmployeeSearchActionImpl#checkSearchCount()が呼び出されます。</p>
<pre>
public String checkSearchCount() {
    if (employeeLogic.getSearchCount(employeeSearchDto) == 0) {
        throw new BadCriteriaRuntimeException();
    }
    return &quot;employeeList&quot;;
}
</pre>
<p>先に該当レコード数をチェックします。この場合employeeLogicにはテーブルEMPを操作するインタフェースEmployeeLogicを実装したクラスEmployeeLogicImpのインスタンスがセットされていて、employeeSearchDtoにはemployeeSearch.htmlへ入力された結果がValueBindingされているいます。getSearchCount()は次のようにemployeeDtoDaoのgetSearchCount()を呼んでいるだけです。</p>
<pre>
public int getSearchCount(EmployeeSearchDto dto) {
    return employeeDtoDao.getSearchCount(dto);
}
</pre>
<p>getSearchCount()でDTOを検索条件として該当レコード数を取得しています。この結果でcheckSearchCount()は該当レコードがなければ例外BadCriteriaRuntimeExceptionをスローします。 該当あれば"employeeList"を返します。この結果、/employee/employeeList.htmlへ遷移します。 
</p>
<h3><a name="employeeList">employeeList.html</a></h3>
<p>/employee/employeeList.htmlはemployeeSearch.htmlへ入力された条件に該当するレコードをリスト表示する画面です。
見ていく順番は以下のようになります。</p>
<ul>
<li><a href="#EmployeeListInitialize">ページの初期処理の説明</a></li>
    <ul>
    <li><a href="#EmployeeListInitializeClass">ページの初期処理のクラス</a></li>
    <ul>
        <li><a href="#EmployeeListInitializeProperty">プロパティ</a></li>
        <li><a href="#EmployeeListInitializeMethod">ページを初期処理するメソッド</a></li>
    </ul>
    </ul>
<li><a href="#EmployeeListView">画面の説明</a></li>
    <ul>
    <li><a href="#EmployeeListTagu">タグ</a></li>
    </ul>
<li><a href="#EmployeeListAction">Actionクラスの説明</a></li>
    <ul>
    <li><a href="#EmployeeListActionDicon">Actionクラスのdiconファイル</a></li>
    <li><a href="#EmployeeListActionClass">Actionクラス</a></li>
    <ul>
        <li><a href="#EmployeeListActionProperty">プロパティ</a></li>
        <li><a href="#EmployeeListActionMethod">Actionクラスのメソッド(MethodBinding)</a></li>
    </ul>
    </ul>
</ul>
<h4><a name="EmployeeListInitialize">ページの初期処理の説明</a></h4>
<pre>
01:&lt;html xmlns:m=&quot;http://www.seasar.org/maya&quot;
02:    <strong>m:action=&quot;#{employeeListInitAction.initialize}&quot;</strong>
03:    m:extends=&quot;/WEB-INF/layout/layout.html&quot;&gt;
</pre>
<p>2行目のaction属性でページを初期化するメソッドを指定しています。 </p>

<h5><a name="EmployeeListInitializeClass">ページの初期処理のクラス</a></h5>
<p>
employeeListInitActionは、<a href="#AutoRegisterForAction">Action自動登録設定</a>によってS2Containerに登録されています。
<ul>
<li>クラスはexamples.jsf.action.impl.EmployeeListInitActionImplです</li>
<li>instanceモードはrequestです</li>
<li>アスペクトとしてactionInterceptorChainが登録されています</li>
</ul>
examples.jsf.action.impl.EmployeeListInitActionImplを見ていきましょう。
</p>

<h5><a name="EmployeeListInitializeProperty">プロパティ</a></h5>
<p>定義されているプロパティは次の通りです。</p>
<pre>
public class EmployeeListInitActionImpl implements EmployeeListInitAction {
    private EmployeeSearchDto employeeSearchDto;
    private EmployeeLogic employeeLogic;
    private List employeeDtoList;
                    :
}
</pre>
<p>employeeSearchDtoは前画面のemployeeSearch.htmlに入力された内容を保持するもので、
sessionスコープで管理されています(examples.jsf.dto.EmployeeSearchDtoクラスのCOMPONENTアノテーションを参照)。
それがsetterメソッドsetEmployeeSearchDto()経由でここにセットされます。
employeeLogicにはテーブルEMPを操作するインタフェースEmployeeLogicを実装したクラスEmployeeLogicImpのインスタンスがセットされます。
employeeDtoListは、initialize()の中でセットされます。そのinitialize()は次のようになっています。
</p>

<h5><a name="EmployeeListInitializeMethod">ページを初期処理するメソッド</a></h5>
<pre>
public String initialize() {
    employeeDtoList = employeeLogic.searchEmployeeDtoList(employeeSearchDto);
    return null;
}
</pre>
<p>EmployeeLogicImp#searchEmployeeDtoList()もEmployeeDtoDaoの同名メソッドを呼び出すだけです。</p>
<pre>
public List searchEmployeeDtoList(EmployeeSearchDto dto) {
    return employeeDtoDao.searchEmployeeDtoList(dto);
}
</pre>

<p>この結果がemployeeDtoListにセットされます。そのemployeeDtoListはgetterメソッドとしてgetEmployeeDtoListがあるので、このプロパティが自動的にrequestスコープの属性として保管されます。</p>
<h5><a name="EmployeeListView">画面の説明</a></h5>
<p>employeeList.htmlの画面組み立てを見ていきましょう。</p>
<h5><a name="EmployeeListTagu"">タグの説明</a></h5>
<p>forEachタグを見てみましょう。</p>
<pre>
&lt;span m:inject=&quot;s:forEach&quot;
    m:items=&quot;#{employeeDtoList}&quot;
    m:var=&quot;e&quot;
    m:varIndex=&quot;i&quot;&gt;
            ：
&lt;/span&gt;
</pre>
<p>サンプルのforEachタグを見てもらえば分かるように、この場合はemployeeDtoList(初期化処理で作成されたテーブルEMPの検索結果)の各要素をeとし、それが何番目の要素かはiで表す、ということになります。実際に繰り返されるのはこのspanタグにはさまれたtrタグです。そのtrタグは以下のようになっています。</p>
<pre>
&lt;tr class=&quot;evenRow&quot; m:class=&quot;#{i % 2 == 0 ? 'evenRow' : 'oddRow'}&quot;&gt;
    &lt;td class=&quot;right&quot;&gt;&lt;span m:value=&quot;#{e.empno}&quot;&gt;7369&lt;/span&gt;&lt;/td&gt;
    &lt;td&gt;&lt;span m:value=&quot;#{e.ename}&quot;&gt;SMITH&lt;/span&gt;&lt;/td&gt;
    &lt;td&gt;&lt;span m:value=&quot;#{e.job}&quot;&gt;CLERK&lt;/span&gt;&lt;/td&gt;
    &lt;td class=&quot;right&quot;&gt;&lt;span m:value=&quot;#{e.mgr}&quot;&gt;7902&lt;/span&gt;&lt;/td&gt;
    &lt;td&gt;&lt;span m:value=&quot;#{e.hiredate}&quot;&gt;1980/12/07&lt;/span&gt;&lt;/td&gt;
    &lt;td class=&quot;right&quot;&gt;&lt;span m:value=&quot;#{e.sal}&quot;&gt;800&lt;/span&gt;&lt;/td&gt;
    &lt;td class=&quot;right&quot;&gt;&lt;span m:value=&quot;#{e.comm}&quot;/&gt;&lt;/td&gt;
    &lt;td&gt;&lt;span m:value=&quot;#{e.dname}&quot;&gt;RESEARCH&lt;/span&gt;&lt;/td&gt;
    &lt;td&gt;&lt;a href=&quot;employeeEdit.html&quot; m:action=&quot;#{employeeListAction.goNext}&quot;&gt;Edit
            &lt;span m:inject=&quot;f:param&quot; m:name=&quot;empno&quot; m:value=&quot;#{e.empno}&quot;/&gt;
            &lt;span m:inject=&quot;f:param&quot; m:name=&quot;processMode&quot; m:value=&quot;2&quot;/&gt;
        &lt;/a&gt;
        &lt;a href=&quot;employeeConfirm.html&quot; m:action=&quot;#{employeeListAction.goNext}&quot;&gt;Delete
            &lt;span m:inject=&quot;f:param&quot; m:name=&quot;empno&quot; m:value=&quot;#{e.empno}&quot;/&gt;
            &lt;span m:inject=&quot;f:param&quot; m:name=&quot;processMode&quot; m:value=&quot;3&quot;/&gt;
        &lt;/a&gt;
        &lt;a href=&quot;employeeConfirm.html&quot; m:action=&quot;#{employeeListAction.goNext}&quot;&gt;Inquire
            &lt;span m:inject=&quot;f:param&quot; m:name=&quot;empno&quot; m:value=&quot;#{e.empno}&quot;/&gt;
            &lt;span m:inject=&quot;f:param&quot; m:name=&quot;processMode&quot; m:value=&quot;4&quot;/&gt;
        &lt;/a&gt;
    &lt;/td&gt;
&lt;/tr&gt;
&lt;/span&gt;
</pre>
<p>以下のようtrタグのm:classに条件式を使用して背景を変えることもできます。</p>
<pre>
&lt;tr class=&quot;evenRow&quot; m:class=&quot;#{i % 2 == 0 ? 'evenRow' : 'oddRow'}&quot;&gt;
</pre>
<p>各行の右端には"Edit","Delete","Inquire"のリンクでセットするパラメータが違うだけで、基本的には同じです。
Editは次のようになっています。</p>
<pre>
&lt;a href=&quot;employeeEdit.html&quot; m:action=&quot;#{employeeListAction.goNext}&quot;&gt;Edit
    &lt;span m:inject=&quot;f:param&quot; m:name=&quot;empno&quot; m:value=&quot;#{e.empno}&quot;/&gt;
    &lt;span m:inject=&quot;f:param&quot; m:name=&quot;processMode&quot; m:value=&quot;2&quot;/&gt;
&lt/a&gt;
</pre>
<h4><a name="EmployeeListAction">Actionクラスの説明</a></h4>
<p>action属性のemployeeListActionを見ていきましょう。</p>

<h4><a name="EmployeeListActionClass">Actionクラス</a></h4>
<p>
employeeListActionは、<a href="#AutoRegisterForAction">Action自動登録設定</a>によってS2Containerに登録されています。
<ul>
<li>クラスはexamples.jsf.action.impl.EmployeeListActionImplです</li>
<li>instanceモードはrequestです</li>
<li>アスペクトとしてactionInterceptorChainが登録されています</li>
</ul>
examples.jsf.action.impl.EmployeeListActionImplクラスを見ていきましょう。
</p>

<h5><a name="EmployeeListActionProperty">プロパティ</a></h5>
<p>定義されてるプロパティは以下の通りです。</p>
<pre>
public class EmployeeListActionImpl implements EmployeeListAction {
    private int processMode;
    private ProcessModeDto processModeDto;
    private Integer empno;
    private EmployeeLogic employeeLogic;
    private EmployeeDto employeeDto;
                :
}
</pre>
<p>processModeとempnoはaタグの子タグでとして指定されたf:paramタグのパラメータ名に一致してsetterメソッドがあるので、S2JSFがMethodBindingで指定したgoNext()を実行する前にパラメータ値をセットします。</p>
<h5><a name="EmployeeListActionMethod">Actionクラスのメソッド(MethodBinding)</a></h5>
<p>goNext()は、processModeを使って遷移先を決定します。</p>
<pre>
public String goNext() {
    processModeDto.setProcessMode(processMode);
    switch (processModeDto.getProcessMode()) {
        case Constants.UPDATE_MODE :
            return "employeeEdit";
        default :
            employeeDto = employeeLogic.getEmployeeDto(empno);
            return "employeeConfirm";
    }
}
</pre>
<p>processModeDtoに選択されたモードをセットして、UPDATE_MODE(Edit)のときは/employee/employeeEdit.html(=employeeEdit) それ以外は/employee/employeeConfirm.html(=employeeConfirm) へ遷移させます。</p>

<!-- document end -->
<!-- don't edit start -->
</td>
<td width="14"><img height="14" width="14" src="images/spacer.gif" alt=""></td>
</tr><tr>
<td width="14"><img height="30" width="14" src="images/spacer.gif" alt=""></td>
<td width="766"><img height="30" width="592" src="images/spacer.gif" alt=""></td>
</tr><tr>
<td width="14"><img height="14" width="14" src="images/spacer.gif" alt=""></td>
<td width="766" class="copyright">Copyright&copy; 2004-2005, The Seasar Foundation and the others. All rights reserved.</td>
</tr></table>
<td class="backright" align="left" valign="top">&nbsp;</td></tr><tr>
<td class="backunder" align="left"  valign="top" width="780" height="16">&nbsp;</td>
<td class="backcorner" align="left" valign="top" height="16">&nbsp;</td>
</tr></table></body>
<!-- don't edit end -->
</html>
